import{j as e,r as b,y as C,a as T,H as V,c as M}from"./app-Zo33inHR.js";import{A as O}from"./AuthenticatedLayout-0SC2YidR.js";import{M as $,S as I}from"./SecondaryButton-Ek-ytVUK.js";import{P as R}from"./PrimaryButton-DDJNzRL2.js";import{S as E}from"./ScrollArea-tkMp0nAt.js";import{F as K}from"./FaturaDetailModal-Ct5vJ_yp.js";import{B as L,A as z}from"./BareButton-BpOYl9pL.js";import{T as H}from"./Tooltip-C_Gv0z5R.js";import{m as q}from"./proxy-DNuHlVw4.js";import{E as W}from"./ExportExcel-h4M97tCt.js";/* empty css            */function U(a){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).format(a||0)}function J(a){if(!a)return"";const o=new Date(a);if(Number.isNaN(o.getTime()))return"";const u=o.getDate().toString().padStart(2,"0"),d=o.toLocaleDateString("pt-BR",{month:"short"});return`${u} ${d}`}function Q({title:a,description:o,amount:u,type:d,status:i,created_at:r,bank_name:m,total_installments:s,current_installment:c,display_installment:l,is_recurring:p,category_name:n,onClick:t}){const x=d==="credit",N=d==="debit",f="-",v="text-rose-500 dark:text-rose-400",S=Math.max(Number(s||1),1),h=Number(u||0)||0,_=S>1?h/S:h,y=J(r),w=i==="paid"?"Pago":i==="overdue"?"Vencido":"Em aberto",g=i==="paid"?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-300":i==="overdue"?"bg-rose-100 text-rose-700 dark:bg-rose-900/40 dark:text-rose-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300",j=s&&s>1?l||c||1:null,k=s&&s>1&&j?`${j}/${s}`:null;return e.jsxs("div",{className:"flex items-center justify-between gap-3 px-2 sm:px-3 lg:px-3 2xl:px-3 py-1.5 lg:py-2 2xl:py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-900/60 transition cursor-pointer",onClick:t,role:t?"button":void 0,tabIndex:t?0:void 0,children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0",children:[e.jsx("div",{className:"h-8 w-8 lg:h-9 lg:w-9 2xl:h-9 2xl:w-9 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center",children:e.jsx("span",{className:`h-2 w-2 rounded-full ${N||x?"bg-rose-500":"bg-gray-400"}`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"truncate text-sm lg:text-base 2xl:text-base font-medium text-gray-900 dark:text-gray-100",children:a}),k&&e.jsx("span",{className:"rounded-full bg-purple-100 px-2.5 py-0.5 text-[11px] sm:text-xs 2xl:text-sm font-semibold uppercase tracking-wide text-purple-700 dark:bg-purple-900/40 dark:text-purple-300",children:k}),p&&e.jsx("span",{className:"rounded-full bg-blue-100 px-2.5 py-0.5 text-[10px] sm:text-[11px] 2xl:text-[11px] font-semibold uppercase tracking-wide text-blue-700 dark:bg-blue-900/40 dark:text-blue-300",children:"Recorrente"})]}),e.jsxs("div",{className:"mt-0.5 flex flex-wrap items-center gap-2 text-[11px] lg:text-xs 2xl:text-xs text-gray-500 dark:text-gray-400",children:[m&&e.jsx("span",{children:m}),n&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-[10px] sm:text-[11px] 2xl:text-[11px] font-medium text-gray-600 dark:bg-gray-800 dark:text-gray-200",children:n}),o&&e.jsxs("span",{className:"truncate max-w-xs",children:["• ",o]})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsxs("span",{className:`text-sm lg:text-base 2xl:text-base font-semibold ${v}`,children:[f,U(_)]}),e.jsxs("div",{className:"flex items-center gap-2 text-[11px] lg:text-xs 2xl:text-xs text-gray-500 dark:text-gray-400",children:[y&&e.jsx("span",{children:y}),e.jsx("span",{className:`rounded-full px-2.5 py-0.5 text-[10px] sm:text-[11px] 2xl:text-[11px] ${g}`,children:w})]})]})]})}function P(a){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).format(a||0)}function X({isOpen:a,onClose:o,monthKey:u,monthLabel:d,items:i=[],bankUserId:r=null,onPaid:m}){const[s,c]=b.useState(!1),l=b.useMemo(()=>i.filter(t=>t.status!=="paid"),[i]),p=b.useMemo(()=>l.reduce((t,x)=>{const N=x.total_installments||1,f=(x.amount||0)/N;return t+f},0),[l]),n=async()=>{if(!s){c(!0),C.dismiss();try{const t={month:u};r&&(t.bank_user_id=r),await T.post(route("faturas.pay_month"),t),C.success("Pagamentos do mês registrados com sucesso."),c(!1),m&&m(),o&&o()}catch(t){console.error(t),c(!1),t.response&&t.response.data?.message?C.error(t.response.data.message):C.error("Erro ao registrar pagamentos do mês.")}}};return e.jsxs($,{isOpen:a,onClose:o,maxWidth:"md",title:`Pagar fatura de ${d}`,children:[e.jsx("div",{className:"space-y-4 text-sm sm:text-base",children:l.length===0?e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Não há pendências para este mês."}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Você está prestes a registrar o pagamento das pendências deste mês."}),e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-3 sm:p-4 text-xs sm:text-sm shadow-sm dark:border-gray-800 dark:bg-[#050505]",children:[e.jsx("p",{className:"mb-2 text-[11px] sm:text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-400",children:"Pendências do mês"}),e.jsx(E,{maxHeightClassName:"max-h-64",className:"space-y-2 pr-1",children:l.map(t=>{const x=t.total_installments||1,N=t.current_installment||0,f=(t.amount||0)/x,v=x>1?t.display_installment||Math.min(N+1,x):1,S=Math.max(x-(v-1),0);return e.jsxs("div",{className:"flex items-center justify-between gap-3 rounded-lg bg-gray-50 px-2.5 py-2 text-gray-700 dark:bg-gray-900 dark:text-gray-200",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-sm font-medium",children:t.title}),e.jsxs("p",{className:"mt-0.5 text-[11px] sm:text-xs text-gray-500 dark:text-gray-400",children:["Parcela atual: ",v,"/",x," • Valor da parcela: ",P(f)]})]}),e.jsx("div",{className:"text-right text-[11px] sm:text-xs text-gray-500 dark:text-gray-400",children:e.jsxs("p",{children:["Restantes: ",S]})})]},t.id)})}),e.jsxs("div",{className:"mt-3 flex items-center justify-between border-t border-dashed border-gray-200 pt-2 text-[11px] sm:text-xs dark:border-gray-700",children:[e.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-300",children:"Total a pagar agora"}),e.jsx("span",{className:"font-semibold text-rose-600 dark:text-rose-400",children:P(p)})]})]}),e.jsx("p",{className:"text-[11px] sm:text-xs text-gray-500 dark:text-gray-400",children:'Observação: faturas parceladas só serão marcadas como "pagas" quando todas as parcelas forem quitadas.'})]})}),e.jsxs("div",{className:"mt-5 flex items-center justify-end gap-3",children:[e.jsx(I,{type:"button",onClick:o,className:"rounded-lg px-4 py-2 text-xs sm:text-sm font-medium text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800",children:"Cancelar"}),e.jsx(R,{type:"button",disabled:s||l.length===0,onClick:n,children:s?"Registrando...":"Confirmar pagamento"})]})]})}function Y(a){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).format(a||0)}function Z({month_label:a,total_spent:o,items:u=[],month_key:d,bankUserId:i=null,onPaid:r,is_paid:m=!1,due_day:s=null,isCurrentPending:c=!1}){const[l,p]=b.useState(!1),[n,t]=b.useState("date"),[x,N]=b.useState("desc"),[f,v]=b.useState(null),S=b.useMemo(()=>{const h=[...u];return h.sort((_,y)=>{if(n==="date"){const w=_.created_at?new Date(_.created_at):null,g=y.created_at?new Date(y.created_at):null,j=w&&!Number.isNaN(w.getTime())?w.getTime():0,k=g&&!Number.isNaN(g.getTime())?g.getTime():0;return x==="asc"?j-k:k-j}if(n==="amount"){const w=Number(_.amount)||0,g=Number(y.amount)||0;return x==="asc"?w-g:g-w}return 0}),h},[u,n,x]);return e.jsxs("section",{className:"space-y-3 sm:space-y-4 lg:space-y-5 2xl:space-y-5",children:[e.jsxs("div",{className:"flex flex-col items-start gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{className:"flex-1 flex justify-start items-center gap-3 sm:gap-4",children:e.jsxs("div",{className:"inline-flex flex-col items-start rounded-2xl sm:rounded-full px-4 py-2 sm:px-6 sm:py-3 bg-transparent",children:[s&&e.jsxs("p",{className:"mt-0.5 text-[11px] sm:text-xs lg:text-sm 2xl:text-sm text-gray-500 dark:text-gray-400",children:["Vencimento do cartão: todo dia ",e.jsx("span",{className:"font-semibold",children:s})]}),e.jsxs("p",{className:"mt-1 text-[11px] sm:text-xs lg:text-sm 2xl:text-sm text-gray-500 dark:text-gray-400",children:["Total de despesas do mês",":",e.jsx("span",{className:"ml-1 font-semibold text-rose-600 dark:text-rose-400",children:Y(o)})]})]})}),c&&e.jsx(R,{type:"button",onClick:()=>p(!0),className:"shrink-0 rounded-full px-4 py-2 text-[11px] sm:text-xs font-semibold uppercase tracking-wide focus:ring-rose-500 focus:ring-offset-2 dark:ring-offset-[#050505] w-full sm:w-auto",children:"Pagar"})]}),e.jsx("div",{className:"rounded-2xl bg-white border border-gray-50/90 dark:border-red-950/50 px-2 py-2 sm:px-3 sm:py-3 lg:px-4 lg:py-3 2xl:px-4 2xl:py-3 shadow-sm ring-1 ring-black/5 dark:bg-[#080808] dark:ring-white/5 shadow-gray-500 dark:shadow-gray-900",children:u.length===0?e.jsx("p",{className:"px-3 py-2 text-xs sm:text-sm lg:text-base 2xl:text-sm text-gray-500 dark:text-gray-400",children:"Nenhuma transação neste mês."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-3 pt-1 pb-1 text-[11px] sm:text-xs lg:text-sm 2xl:text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-semibold uppercase tracking-wide",children:"Ordenar"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{type:"button",onClick:()=>t("date"),className:`inline-flex items-center rounded-full border px-3 py-1.5 text-[10px] sm:text-[11px] 2xl:text-[11px] font-medium transition ${n==="date"?"border-[#7b1818] bg-[#7b1818] text-white shadow-sm dark:border-rose-500 dark:bg-rose-500":"border-gray-300 bg-white text-gray-600 hover:bg-gray-50 dark:border-gray-700 dark:bg-[#050505] dark:text-gray-200 dark:hover:bg-gray-800"}`,children:"Data"}),e.jsx(L,{type:"button",onClick:()=>t("amount"),className:`inline-flex items-center rounded-full border px-3 py-1.5 text-[10px] sm:text-[11px] 2xl:text-[11px] font-medium transition ${n==="amount"?"border-[#7b1818] bg-[#7b1818] text-white shadow-sm dark:border-rose-500 dark:bg-rose-500":"border-gray-300 bg-white text-gray-600 hover:bg-gray-50 dark:border-gray-700 dark:bg-[#050505] dark:text-gray-200 dark:hover:bg-gray-800"}`,children:"Valor"}),e.jsx(H,{label:x==="desc"?"Do mais recente/mais caro para o mais antigo/mais barato":"Do mais antigo/mais barato para o mais recente/mais caro",children:e.jsx(L,{type:"button",onClick:()=>N(h=>h==="desc"?"asc":"desc"),className:"inline-flex items-center rounded-full border border-gray-300 bg-white px-2.5 py-1.5 text-[10px] sm:text-[11px] 2xl:text-[11px] font-medium text-gray-600 shadow-sm hover:bg-gray-50 dark:border-gray-700 dark:bg-[#050505] dark:text-gray-200 dark:hover:bg-gray-800",children:x==="desc"?"▼":"▲"})})]})]}),e.jsx(E,{maxHeightClassName:"max-h-[360px] md:max-h-[420px] lg:max-h-[460px] 2xl:max-h-[400px]",className:"divide-y divide-gray-100 dark:divide-gray-800",children:S.map(h=>e.jsx(Q,{...h,onClick:()=>v(h)},h.id))})]})}),e.jsx(X,{isOpen:l,onClose:()=>p(!1),monthKey:d,monthLabel:a,items:u,bankUserId:i,onPaid:r}),e.jsx(K,{isOpen:!!f,onClose:()=>v(null),item:f})]})}function G({months:a=[],total_spent:o,selectedMonthKey:u,onChangeMonth:d}){if(!a||a.length===0)return null;const i=a.findIndex(h=>h.month_key===u),r=i===-1?0:i,m=a[r],s=a[r-1]||null,c=a[r+1]||null,l=m?.is_paid,p=!!s,n=!!c,[t,x]=b.useState(0),N=()=>{p&&(x(-1),d(s.month_key))},f=()=>{n&&(x(1),d(c.month_key))},v={enter:h=>({x:h>0?100:-100,opacity:0,scale:.96}),center:{x:0,opacity:1,scale:1,transition:{type:"spring",stiffness:260,damping:25}},exit:h=>({x:h<0?100:-100,opacity:0,scale:.96,transition:{duration:.18}})};function S(h){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).format(h||0)}return e.jsxs("div",{className:"flex flex-col items-stretch gap-2 sm:flex-row sm:items-center sm:justify-center sm:gap-3 lg:gap-4 2xl:gap-4",children:[e.jsx("div",{className:"flex justify-between sm:w-32 sm:justify-end",children:s&&e.jsx(I,{type:"button",onClick:N,className:"rounded-full px-3 py-1 text-[11px] font-medium text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-900 border-none shadow-none",children:s.month_label})}),e.jsx("div",{className:"flex-1 flex justify-center",children:e.jsx(z,{custom:t,initial:!1,mode:"wait",children:e.jsxs(q.div,{custom:t,variants:v,initial:"enter",animate:"center",exit:"exit",className:`inline-flex flex-col items-center rounded-full px-4 py-2 sm:px-6 sm:py-2 lg:px-8 lg:py-3 2xl:px-8 2xl:py-3 shadow-sm ring-1 bg-gradient-to-r dark:bg-gradient-to-r ${l?"from-emerald-50 via-white to-emerald-50 ring-emerald-200 dark:from-[#052e26] dark:via-[#050505] dark:to-[#052e26] dark:ring-emerald-900/50":"from-rose-50 via-white to-rose-50 ring-rose-100 dark:from-[#150709] dark:via-[#0b0b0b] dark:to-[#150709] dark:ring-rose-900/40"}`,children:[l?e.jsx("span",{className:"text-sm font-medium text-emerald-600 dark:text-emerald-400",children:"Paga"}):e.jsx("div",{}),e.jsx("span",{className:`mt-1 text-lg sm:text-xl md:text-2xl lg:text-3xl 2xl:text-3xl font-bold tracking-tight ${l?"text-emerald-600 dark:text-emerald-400":"text-gray-900 dark:text-gray-50"}`,children:m.month_label}),e.jsx("span",{className:`font-semibold text-xl sm:text-2xl lg:text-3xl 2xl:text-3xl ${l?"text-emerald-600 dark:text-emerald-400":"text-rose-600 dark:text-rose-400"}`,children:S(o)})]},m.month_key)})}),e.jsx("div",{className:"flex justify-between sm:w-32 sm:justify-start",children:c&&e.jsx(I,{type:"button",onClick:f,className:"rounded-full px-3 py-1 text-[11px] sm:text-xs 2xl:text-sm font-medium text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-900 border-none shadow-none",children:c.month_label})})]})}function ee({monthlyGroups:a=[]}){const{rows:o,header:u}=b.useMemo(()=>{if(!a||a.length===0)return{rows:[],header:{}};const d=[],i={};a.forEach(n=>{!n||!n.month_key||n.is_paid||(d.push(n.month_key),n.month_label&&(i[n.month_key]=n.month_label))});const r=Array.from(new Set(d)).sort(),m=new Map;a.forEach(n=>{const t=n.month_key;!t||n.is_paid||!n.items||n.items.forEach(x=>{if(!x||x.status==="paid")return;const N=x.category_name||x.title||"Sem categoria",f=N,v=Math.max(Number(x.total_installments||1),1),h=(Number(x.amount||0)||0)/v;if(!m.has(f)){const y={label:N};r.forEach(w=>{y[w]=0}),y.total=0,m.set(f,y)}const _=m.get(f);_[t]=Number(_[t]||0)+h,_.total=Number(_.total||0)+h})});const s=Array.from(m.values());if(s.length===0)return{rows:[],header:{}};const c={label:"TOTAL GERAL"};let l=0;r.forEach(n=>{let t=0;s.forEach(x=>{t+=Number(x[n]||0)}),l+=t,c[n]=t}),c.total=l,s.push(c);const p={label:{name:"Categoria / Compra"}};return r.forEach(n=>{p[n]={name:i[n]||n}}),p.total={name:"TOTAL"},{rows:s,header:p}},[a]);return!o||o.length===0?null:e.jsx(W,{data:o,header:u,name:"faturas_pendentes"})}function A(...a){return a.filter(Boolean).join(" ")}function te({months:a=[],value:o,onChange:u}){const[d,i]=b.useState(!1),r=b.useRef(null),m=b.useRef(null),s=a.find(l=>l.month_key===o)||a[0]||null;if(b.useEffect(()=>{if(!d)return;const l=p=>{m.current&&!m.current.contains(p.target)&&r.current&&!r.current.contains(p.target)&&i(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[d]),!a||a.length===0)return null;const c=l=>{u&&u(l),i(!1)};return e.jsxs("div",{className:"relative inline-block text-left",children:[e.jsxs("button",{type:"button",ref:r,onClick:()=>i(l=>!l),className:"inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-2.5 py-1.5 text-[11px] lg:text-xs 2xl:text-xs shadow-sm focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-rose-500 dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100",children:[e.jsx("span",{className:"inline-flex flex-col text-left",children:e.jsxs("span",{className:"text-[11px] lg:text-xs 2xl:text-xs font-medium text-gray-900 dark:text-gray-100",children:[s?s.month_label:"Selecione um mês",s&&s.is_paid?" (paga)":""]})}),e.jsx("svg",{className:A("h-4 w-4 text-gray-500 dark:text-gray-400 transition-transform",d?"rotate-180":"rotate-0"),viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M5.25 7.5L10 12.25L14.75 7.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]}),d&&e.jsx("div",{ref:m,className:"absolute right-0 z-20 mt-2 w-64 sm:w-80 2xl:w-80 origin-top-right rounded-2xl bg-white p-3 shadow-xl ring-1 ring-black/5 dark:bg-[#050505] dark:ring-black/40",children:e.jsx(E,{maxHeightClassName:"max-h-56 2xl:max-h-56",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 mr-2",children:a.map(l=>{const p=l.month_key===(s&&s.month_key);return l.is_paid,e.jsx("button",{type:"button",onClick:()=>c(l.month_key),className:A("flex flex-col items-start rounded-xl border px-2.5 py-2 text-left transition-colors","hover:border-rose-400 hover:bg-rose-50/60 dark:hover:border-rose-500/70 dark:hover:bg-rose-900/20",p?"border-rose-500 bg-rose-50 dark:border-rose-500/80 dark:bg-rose-900/30":"border-gray-200 bg-gray-50/60 dark:border-gray-800 dark:bg-[#050505]"),children:e.jsx("span",{className:"text-sm 2xl:text-sm font-medium text-gray-800 dark:text-gray-100 leading-tight",children:l.month_label})},l.month_key)})})})})]})}function ae({bankAccounts:a=[],categories:o=[],filters:u={},months:d=[],monthValue:i,onFiltersChange:r,onMonthChange:m}){const s=u?.bank_user_id??"",c=u?.category_id??"",l=t=>{const x=t.target.value||void 0;r&&r({bank_user_id:x,category_id:c||void 0})},p=t=>{const x=t.target.value||void 0;r&&r({bank_user_id:s||void 0,category_id:x})},n=t=>{!t||!m||m(t)};return e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs sm:text-sm lg:text-sm 2xl:text-sm",children:[e.jsxs("select",{value:s||"",onChange:l,className:"min-w-[190px] sm:min-w-[210px] lg:min-w-[230px] 2xl:min-w-[230px] rounded-lg border border-gray-300 bg-white px-2.5 py-1.5 text-xs sm:text-sm 2xl:text-sm shadow-sm focus:border-rose-500 focus:ring-rose-500 dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Todos os bancos"}),a.map(t=>e.jsxs("option",{value:t.id,children:[t.name,t.due_day?` - vence todo dia ${t.due_day}`:""]},t.id))]}),e.jsxs("select",{value:c||"",onChange:p,className:"min-w-[190px] sm:min-w-[210px] lg:min-w-[230px] 2xl:min-w-[230px] rounded-lg border border-gray-300 bg-white px-2.5 py-1.5 text-xs sm:text-sm 2xl:text-sm shadow-sm focus:border-rose-500 focus:ring-rose-500 dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Todas as categorias"}),o.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),d&&d.length>0&&e.jsx(te,{months:d,value:i,onChange:n})]})}function D(a){if(!a||typeof a!="string")return 0;const[o,u]=a.split("-"),d=parseInt(o,10)||0,i=parseInt(u,10)||0;return d*12+(i-1)}function B(a,o){if(!a||a.length===0)return null;if(o){if(a.some(m=>m.month_key===o))return o;const d=D(o);let i=a[0],r=Math.abs(D(i.month_key)-d);for(const m of a){const s=Math.abs(D(m.month_key)-d);s<r&&(i=m,r=s)}return i.month_key}return a[0].month_key}function re(a="",o,u){const[d,i]=b.useState(a);return{value:d,setValue:i,handleChange:s=>{let c=s.target.value??"";c=c.replace(/[^0-9]/g,"");{const l=String(u).length;c.length>l&&(c=c.slice(0,l))}i(c)},isValid:(()=>{if(d==="")return!1;const s=parseInt(d,10);return!(Number.isNaN(s)||s<o||s>u)})(),numericValue:d===""?null:parseInt(d,10)}}function pe({monthlyGroups:a=[],bankAccounts:o=[],categories:u=[],filters:d={},currentMonthKey:i=null}){const r=b.useMemo(()=>{if(!Array.isArray(a))return[];const g=new Map;for(const k of a)!k||!k.month_key||typeof k.month_key!="string"||g.has(k.month_key)||g.set(k.month_key,k);const j=Array.from(g.values());return j.sort((k,F)=>D(k.month_key)-D(F.month_key)),j},[a]),m=d?.bank_user_id??"",[s,c]=b.useState(()=>B(r,i)),[l,p]=b.useState(!1),n=re("",1,31),[t,x]=b.useState(!1);b.useEffect(()=>{if(!r||r.length===0){c(null);return}if(!r.some(j=>j.month_key===s)){const j=B(r,i);c(j)}},[r,s,i]);const N=g=>{M.get(route("faturas.index"),g,{preserveState:!0,preserveScroll:!0})},f=o&&o.length>0&&m?o.find(g=>String(g.id)===String(m)):null,v=g=>{c(g)},S=()=>{f&&(n.setValue(f.due_day?String(f.due_day):""),p(!0))},h=async g=>{if(g.preventDefault(),!f||t)return;if(!n.isValid){C.error("Informe um dia de vencimento entre 1 e 31.");return}const j=n.numericValue;x(!0),C.dismiss();try{await T.patch(route("banks.update-due-day",f.id),{due_day:j}),C.success("Dia de vencimento atualizado com sucesso."),p(!1),M.reload({only:["bankAccounts"]})}catch(k){console.error(k),C.error("Não foi possível atualizar o dia de vencimento.")}finally{x(!1)}},_=()=>{if(!r||r.length===0||!y){M.reload({only:["monthlyGroups"],preserveState:!0});return}const g=r.findIndex(F=>F.month_key===y.month_key),j=g>0?g-1:g,k=r[j]||y;c(k.month_key),M.reload({only:["monthlyGroups"],preserveState:!0})},y=r&&r.length>0?r.find(g=>g.month_key===s)||r[0]:null,w=B(r,i);return e.jsxs(O,{children:[e.jsx(V,{title:"Faturas"}),e.jsxs("div",{className:"w-full max-w-[1500px] 2xl:max-w-[1600px] mx-auto px-3 sm:px-4 lg:px-6 2xl:px-6 space-y-4 sm:space-y-5 lg:space-y-6 2xl:space-y-6",children:[e.jsxs("header",{className:"pt-1 sm:pt-2 space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl 2xl:text-3xl font-semibold text-gray-900 mb-1 dark:text-gray-100",children:"Faturas"}),e.jsx("p",{className:"text-xs sm:text-sm lg:text-base 2xl:text-base text-gray-600 dark:text-gray-300",children:"Visualize suas despesas agrupadas por mês."})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsx(ae,{bankAccounts:o,categories:u,filters:d,months:r,monthValue:y?.month_key||s,onFiltersChange:N,onMonthChange:v}),e.jsx("div",{className:"flex justify-start md:justify-end",children:e.jsx(ee,{monthlyGroups:a})})]}),f&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs sm:text-sm 2xl:text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("span",{children:["Dia de vencimento:"," ",f.due_day?`todo dia ${f.due_day}`:"ainda não definido"]}),e.jsx(I,{type:"button",onClick:S,className:"rounded-full px-4 py-1.5 text-[11px] sm:text-xs font-semibold uppercase tracking-wide text-rose-600 border border-rose-500 hover:bg-rose-50 dark:border-rose-500/70 dark:text-rose-300 dark:hover:bg-rose-900/20",children:"Definir dia de vencimento"})]})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4 lg:space-y-5 2xl:space-y-5 pb-4 sm:pb-6 2xl:pb-6",children:[(!r||r.length===0)&&e.jsx("p",{className:"text-xs sm:text-sm lg:text-base 2xl:text-base text-gray-500 dark:text-gray-400",children:"Nenhuma fatura encontrada para o filtro atual."}),r&&r.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(G,{months:r,selectedMonthKey:y?.month_key,onChangeMonth:v,...y}),y&&e.jsx(Z,{...y,month_key:y.month_key,bankUserId:m||null,due_day:f?.due_day??null,onPaid:_,isCurrentPending:w&&y.month_key===w&&!y.is_paid},y.month_key)]})]}),e.jsx($,{isOpen:l,onClose:()=>!t&&p(!1),maxWidth:"sm",title:"Definir dia de vencimento",children:e.jsxs("form",{className:"space-y-4",onSubmit:h,noValidate:!0,children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 dark:text-gray-200",children:"Dia de vencimento do cartão (1 a 31)"}),e.jsx("input",{type:"number",min:1,max:31,inputMode:"numeric",value:n.value,onChange:n.handleChange,className:"w-full rounded-md border border-gray-300 bg-white p-2 text-xs sm:text-sm shadow-sm dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-2 text-xs sm:text-xs",children:[e.jsx(I,{type:"button",onClick:()=>!t&&p(!1),className:"rounded-lg px-4 py-2 font-medium text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800",children:"Cancelar"}),e.jsx(R,{type:"submit",disabled:t,className:"rounded-lg px-4 py-2 font-semibold uppercase tracking-wide disabled:cursor-not-allowed",children:t?"Salvando...":"Salvar dia"})]})]})})]})]})}export{pe as default};
