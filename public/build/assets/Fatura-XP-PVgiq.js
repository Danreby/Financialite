import{j as e,r as b,y as C,a as $,H as O,c as F}from"./app-C2oUZ3c5.js";import{A as z}from"./AuthenticatedLayout-DhXt9-BM.js";import{M as V,S as M}from"./SecondaryButton-Bnu3YlYw.js";import{P as L}from"./PrimaryButton-BgMzS8WV.js";import{S as E}from"./ScrollArea-DURtw3S-.js";import{F as H}from"./FaturaDetailModal-OnEntpkg.js";import{B,A as q}from"./BareButton-DDzAs1Fk.js";import{T as U}from"./Tooltip-CF-mDUpb.js";import{m as W}from"./proxy-BMRgWjfz.js";import{E as K}from"./ExportExcel-NZjHD6LS.js";/* empty css            */function J(r){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).format(r||0)}function Q(r){if(!r)return"";const d=new Date(r);if(Number.isNaN(d.getTime()))return"";const p=d.getDate().toString().padStart(2,"0"),i=d.toLocaleDateString("pt-BR",{month:"short"});return`${p} ${i}`}function X({title:r,description:d,amount:p,type:i,status:x,created_at:a,bank_name:u,total_installments:s,current_installment:m,display_installment:l,is_recurring:f,category_name:o,onClick:t}){const c=i==="credit",v=i==="debit",h="-",w="text-rose-500 dark:text-rose-400",S=Math.max(Number(s||1),1),k=Number(p||0)||0,_=S>1?k/S:k,n=Q(a),N=x==="paid"?"Pago":x==="overdue"?"Vencido":"Em aberto",g=x==="paid"?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-300":x==="overdue"?"bg-rose-100 text-rose-700 dark:bg-rose-900/40 dark:text-rose-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300",j=s&&s>1?l||m||1:null,y=s&&s>1&&j?`${j}/${s}`:null;return e.jsxs("div",{className:"flex items-center justify-between gap-3 px-2 sm:px-3 lg:px-3 2xl:px-3 py-1.5 lg:py-2 2xl:py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-900/60 transition cursor-pointer",onClick:t,role:t?"button":void 0,tabIndex:t?0:void 0,children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0",children:[e.jsx("div",{className:"h-8 w-8 lg:h-9 lg:w-9 2xl:h-9 2xl:w-9 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center",children:e.jsx("span",{className:`h-2 w-2 rounded-full ${v||c?"bg-rose-500":"bg-gray-400"}`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"truncate text-sm lg:text-base 2xl:text-base font-medium text-gray-900 dark:text-gray-100",children:r}),y&&e.jsx("span",{className:"rounded-full bg-purple-100 px-2.5 py-0.5 text-[11px] sm:text-xs 2xl:text-sm font-semibold uppercase tracking-wide text-purple-700 dark:bg-purple-900/40 dark:text-purple-300",children:y}),f&&e.jsx("span",{className:"rounded-full bg-blue-100 px-2.5 py-0.5 text-[10px] sm:text-[11px] 2xl:text-[11px] font-semibold uppercase tracking-wide text-blue-700 dark:bg-blue-900/40 dark:text-blue-300",children:"Recorrente"})]}),e.jsxs("div",{className:"mt-0.5 flex flex-wrap items-center gap-2 text-[11px] lg:text-xs 2xl:text-xs text-gray-500 dark:text-gray-400",children:[u&&e.jsx("span",{children:u}),o&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-[10px] sm:text-[11px] 2xl:text-[11px] font-medium text-gray-600 dark:bg-gray-800 dark:text-gray-200",children:o}),d&&e.jsxs("span",{className:"truncate max-w-xs",children:["• ",d]})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsxs("span",{className:`text-sm lg:text-base 2xl:text-base font-semibold ${w}`,children:[h,J(_)]}),e.jsxs("div",{className:"flex items-center gap-2 text-[11px] lg:text-xs 2xl:text-xs text-gray-500 dark:text-gray-400",children:[n&&e.jsx("span",{children:n}),e.jsx("span",{className:`rounded-full px-2.5 py-0.5 text-[10px] sm:text-[11px] 2xl:text-[11px] ${g}`,children:N})]})]})]})}function A(r){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).format(r||0)}function Y({isOpen:r,onClose:d,monthKey:p,monthLabel:i,items:x=[],bankUserId:a=null,onPaid:u}){const[s,m]=b.useState(!1),l=b.useMemo(()=>x.filter(t=>t.status!=="paid"),[x]),f=b.useMemo(()=>l.reduce((t,c)=>{const v=c.total_installments||1,h=(c.amount||0)/v;return t+h},0),[l]),o=async()=>{if(!s){m(!0),C.dismiss();try{const t={month:p};a&&(t.bank_user_id=a),await $.post(route("faturas.pay_month"),t),C.success("Pagamentos do mês registrados com sucesso."),m(!1),u&&u(),d&&d()}catch(t){console.error(t),m(!1),t.response&&t.response.data?.message?C.error(t.response.data.message):C.error("Erro ao registrar pagamentos do mês.")}}};return e.jsxs(V,{isOpen:r,onClose:d,maxWidth:"md",title:`Pagar fatura de ${i}`,children:[e.jsx("div",{className:"space-y-4 text-sm sm:text-base",children:l.length===0?e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Não há pendências para este mês."}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Você está prestes a registrar o pagamento das pendências deste mês."}),e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-3 sm:p-4 text-xs sm:text-sm shadow-sm dark:border-gray-800 dark:bg-[#050505]",children:[e.jsx("p",{className:"mb-2 text-[11px] sm:text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-400",children:"Pendências do mês"}),e.jsx(E,{maxHeightClassName:"max-h-64",className:"space-y-2 pr-1",children:l.map(t=>{const c=t.total_installments||1,v=t.current_installment||0,h=(t.amount||0)/c,w=c>1?t.display_installment||Math.min(v+1,c):1,S=Math.max(c-(w-1),0);return e.jsxs("div",{className:"flex items-center justify-between gap-3 rounded-lg bg-gray-50 px-2.5 py-2 text-gray-700 dark:bg-gray-900 dark:text-gray-200",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-sm font-medium",children:t.title}),e.jsxs("p",{className:"mt-0.5 text-[11px] sm:text-xs text-gray-500 dark:text-gray-400",children:["Parcela atual: ",w,"/",c," • Valor da parcela: ",A(h)]})]}),e.jsx("div",{className:"text-right text-[11px] sm:text-xs text-gray-500 dark:text-gray-400",children:e.jsxs("p",{children:["Restantes: ",S]})})]},t.id)})}),e.jsxs("div",{className:"mt-3 flex items-center justify-between border-t border-dashed border-gray-200 pt-2 text-[11px] sm:text-xs dark:border-gray-700",children:[e.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-300",children:"Total a pagar agora"}),e.jsx("span",{className:"font-semibold text-rose-600 dark:text-rose-400",children:A(f)})]})]}),e.jsx("p",{className:"text-[11px] sm:text-xs text-gray-500 dark:text-gray-400",children:'Observação: faturas parceladas só serão marcadas como "pagas" quando todas as parcelas forem quitadas.'})]})}),e.jsxs("div",{className:"mt-5 flex items-center justify-end gap-3",children:[e.jsx(M,{type:"button",onClick:d,className:"rounded-lg px-4 py-2 text-xs sm:text-sm font-medium text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800",children:"Cancelar"}),e.jsx(L,{type:"button",disabled:s||l.length===0,onClick:o,children:s?"Registrando...":"Confirmar pagamento"})]})]})}function Z(r){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).format(r||0)}function G({month_label:r,total_spent:d,items:p=[],month_key:i,bankUserId:x=null,onPaid:a,is_paid:u=!1,due_day:s=null,isCurrentPending:m=!1}){const[l,f]=b.useState(!1),[o,t]=b.useState("date"),[c,v]=b.useState("desc"),[h,w]=b.useState(null),S=b.useMemo(()=>{const k=[...p];return k.sort((_,n)=>{if(o==="date"){const N=_.created_at?new Date(_.created_at):null,g=n.created_at?new Date(n.created_at):null,j=N&&!Number.isNaN(N.getTime())?N.getTime():0,y=g&&!Number.isNaN(g.getTime())?g.getTime():0;return c==="asc"?j-y:y-j}if(o==="amount"){const N=Number(_.amount)||0,g=Number(n.amount)||0;return c==="asc"?N-g:g-N}return 0}),k},[p,o,c]);return e.jsxs("section",{className:"space-y-3 sm:space-y-4 lg:space-y-5 2xl:space-y-5",children:[e.jsxs("div",{className:"flex flex-col items-start gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{className:"flex-1 flex justify-start items-center gap-3 sm:gap-4",children:e.jsxs("div",{className:"inline-flex flex-col items-start rounded-2xl sm:rounded-full px-4 py-2 sm:px-6 sm:py-3 bg-transparent",children:[s&&e.jsxs("p",{className:"mt-0.5 text-[11px] sm:text-xs lg:text-sm 2xl:text-sm text-gray-500 dark:text-gray-400",children:["Vencimento do cartão: todo dia ",e.jsx("span",{className:"font-semibold",children:s})]}),e.jsxs("p",{className:"mt-1 text-[11px] sm:text-xs lg:text-sm 2xl:text-sm text-gray-500 dark:text-gray-400",children:["Total de despesas do mês",":",e.jsx("span",{className:"ml-1 font-semibold text-rose-600 dark:text-rose-400",children:Z(d)})]})]})}),m&&e.jsx(L,{type:"button",onClick:()=>f(!0),className:"shrink-0 rounded-full px-4 py-2 text-[11px] sm:text-xs font-semibold uppercase tracking-wide focus:ring-rose-500 focus:ring-offset-2 dark:ring-offset-[#050505] w-full sm:w-auto",children:"Pagar"})]}),e.jsx("div",{className:"rounded-2xl bg-white border border-gray-50/90 dark:border-red-950/50 px-2 py-2 sm:px-3 sm:py-3 lg:px-4 lg:py-3 2xl:px-4 2xl:py-3 shadow-sm ring-1 ring-black/5 dark:bg-[#080808] dark:ring-white/5 shadow-gray-500 dark:shadow-gray-900",children:p.length===0?e.jsx("p",{className:"px-3 py-2 text-xs sm:text-sm lg:text-base 2xl:text-sm text-gray-500 dark:text-gray-400",children:"Nenhuma transação neste mês."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-3 pt-1 pb-1 text-[11px] sm:text-xs lg:text-sm 2xl:text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-semibold uppercase tracking-wide",children:"Ordenar"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{type:"button",onClick:()=>t("date"),className:`inline-flex items-center rounded-full border px-3 py-1.5 text-[10px] sm:text-[11px] 2xl:text-[11px] font-medium transition ${o==="date"?"border-[#7b1818] bg-[#7b1818] text-white shadow-sm dark:border-rose-500 dark:bg-rose-500":"border-gray-300 bg-white text-gray-600 hover:bg-gray-50 dark:border-gray-700 dark:bg-[#050505] dark:text-gray-200 dark:hover:bg-gray-800"}`,children:"Data"}),e.jsx(B,{type:"button",onClick:()=>t("amount"),className:`inline-flex items-center rounded-full border px-3 py-1.5 text-[10px] sm:text-[11px] 2xl:text-[11px] font-medium transition ${o==="amount"?"border-[#7b1818] bg-[#7b1818] text-white shadow-sm dark:border-rose-500 dark:bg-rose-500":"border-gray-300 bg-white text-gray-600 hover:bg-gray-50 dark:border-gray-700 dark:bg-[#050505] dark:text-gray-200 dark:hover:bg-gray-800"}`,children:"Valor"}),e.jsx(U,{label:c==="desc"?"Do mais recente/mais caro para o mais antigo/mais barato":"Do mais antigo/mais barato para o mais recente/mais caro",children:e.jsx(B,{type:"button",onClick:()=>v(k=>k==="desc"?"asc":"desc"),className:"inline-flex items-center rounded-full border border-gray-300 bg-white px-2.5 py-1.5 text-[10px] sm:text-[11px] 2xl:text-[11px] font-medium text-gray-600 shadow-sm hover:bg-gray-50 dark:border-gray-700 dark:bg-[#050505] dark:text-gray-200 dark:hover:bg-gray-800",children:c==="desc"?"▼":"▲"})})]})]}),e.jsx(E,{maxHeightClassName:"max-h-[360px] md:max-h-[420px] lg:max-h-[460px] 2xl:max-h-[400px]",className:"divide-y divide-gray-100 dark:divide-gray-800",children:S.map(k=>e.jsx(X,{...k,onClick:()=>w(k)},k.id))})]})}),e.jsx(Y,{isOpen:l,onClose:()=>f(!1),monthKey:i,monthLabel:r,items:p,bankUserId:x,onPaid:a}),e.jsx(H,{isOpen:!!h,onClose:()=>w(null),item:h})]})}function ee({months:r=[],total_spent:d,selectedMonthKey:p,onChangeMonth:i}){if(!r||r.length===0)return null;const x=(n,N)=>{if(!n||typeof n!="string")return N||n||"";const[g,j]=n.split("-"),y=parseInt(g,10),D=parseInt(j,10);if(!y||!D)return N||n;try{const P=new Date(y,D-1,1);return new Intl.DateTimeFormat("pt-BR",{month:"long",year:"numeric"}).format(P)}catch{return N||n}},a=n=>!n||typeof n!="string"?n:n.charAt(0).toUpperCase()+n.slice(1),u=r.findIndex(n=>n.month_key===p),s=u===-1?0:u,m=r[s],l=r[s-1]||null,f=r[s+1]||null,o=m?.is_paid,t=!!l,c=!!f,[v,h]=b.useState(0),w=()=>{t&&(h(-1),i(l.month_key))},S=()=>{c&&(h(1),i(f.month_key))},k={enter:n=>({x:n>0?100:-100,opacity:0,scale:.96}),center:{x:0,opacity:1,scale:1,transition:{type:"spring",stiffness:260,damping:25}},exit:n=>({x:n<0?100:-100,opacity:0,scale:.96,transition:{duration:.18}})};function _(n){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).format(n||0)}return e.jsxs("div",{className:"flex flex-col items-stretch gap-2 sm:flex-row sm:items-center sm:justify-center sm:gap-3 lg:gap-4 2xl:gap-4",children:[e.jsx("div",{className:"flex justify-between sm:w-32 sm:justify-end",children:l&&e.jsx(M,{type:"button",onClick:w,className:"rounded-full px-3 py-1 text-[11px] font-medium text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-900 border-none shadow-none",children:x(l.month_key,l.month_label)})}),e.jsx("div",{className:"flex-1 flex justify-center",children:e.jsx(q,{custom:v,initial:!1,mode:"wait",children:e.jsxs(W.div,{custom:v,variants:k,initial:"enter",animate:"center",exit:"exit",className:`inline-flex flex-col items-center rounded-full px-4 py-2 sm:px-6 sm:py-2 lg:px-8 lg:py-3 2xl:px-8 2xl:py-3 shadow-sm ring-1 bg-gradient-to-r dark:bg-gradient-to-r ${o?"from-emerald-50 via-white to-emerald-50 ring-emerald-200 dark:from-[#052e26] dark:via-[#050505] dark:to-[#052e26] dark:ring-emerald-900/50":"from-rose-50 via-white to-rose-50 ring-rose-100 dark:from-[#150709] dark:via-[#0b0b0b] dark:to-[#150709] dark:ring-rose-900/40"}`,children:[o?e.jsx("span",{className:"text-sm font-medium text-emerald-600 dark:text-emerald-400",children:"Paga"}):e.jsx("div",{}),e.jsx("span",{className:`mt-1 text-lg sm:text-xl md:text-2xl lg:text-3xl 2xl:text-3xl font-bold tracking-tight ${o?"text-emerald-600 dark:text-emerald-400":"text-gray-900 dark:text-gray-50"}`,children:a(x(m.month_key,m.month_label))}),e.jsx("span",{className:`font-semibold text-xl sm:text-2xl lg:text-3xl 2xl:text-3xl ${o?"text-emerald-600 dark:text-emerald-400":"text-rose-600 dark:text-rose-400"}`,children:_(d)})]},m.month_key)})}),e.jsx("div",{className:"flex justify-between sm:w-32 sm:justify-start",children:f&&e.jsx(M,{type:"button",onClick:S,className:"rounded-full px-3 py-1 text-[11px] sm:text-xs 2xl:text-sm font-medium text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-900 border-none shadow-none",children:x(f.month_key,f.month_label)})})]})}function te({monthlyGroups:r=[]}){const{rows:d,header:p}=b.useMemo(()=>{if(!r||r.length===0)return{rows:[],header:{}};const i=[],x={};r.forEach(o=>{!o||!o.month_key||o.is_paid||(i.push(o.month_key),o.month_label&&(x[o.month_key]=o.month_label))});const a=Array.from(new Set(i)).sort(),u=new Map;r.forEach(o=>{const t=o.month_key;!t||o.is_paid||!o.items||o.items.forEach(c=>{if(!c||c.status==="paid")return;const v=c.category_name||c.title||"Sem categoria",h=v,w=Math.max(Number(c.total_installments||1),1),k=(Number(c.amount||0)||0)/w;if(!u.has(h)){const n={label:v};a.forEach(N=>{n[N]=0}),n.total=0,u.set(h,n)}const _=u.get(h);_[t]=Number(_[t]||0)+k,_.total=Number(_.total||0)+k})});const s=Array.from(u.values());if(s.length===0)return{rows:[],header:{}};const m={label:"TOTAL GERAL"};let l=0;a.forEach(o=>{let t=0;s.forEach(c=>{t+=Number(c[o]||0)}),l+=t,m[o]=t}),m.total=l,s.push(m);const f={label:{name:"Categoria / Compra"}};return a.forEach(o=>{f[o]={name:x[o]||o}}),f.total={name:"TOTAL"},{rows:s,header:f}},[r]);return!d||d.length===0?null:e.jsx(K,{data:d,header:p,name:"faturas_pendentes"})}function T(...r){return r.filter(Boolean).join(" ")}function re({months:r=[],value:d,onChange:p}){const[i,x]=b.useState(!1),a=b.useRef(null),u=b.useRef(null),s=r.find(l=>l.month_key===d)||r[0]||null;if(b.useEffect(()=>{if(!i)return;const l=f=>{u.current&&!u.current.contains(f.target)&&a.current&&!a.current.contains(f.target)&&x(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[i]),!r||r.length===0)return null;const m=l=>{p&&p(l),x(!1)};return e.jsxs("div",{className:"relative inline-block text-left",children:[e.jsxs("button",{type:"button",ref:a,onClick:()=>x(l=>!l),className:"inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-2.5 py-1.5 text-[11px] lg:text-xs 2xl:text-xs shadow-sm focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-rose-500 dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100",children:[e.jsx("span",{className:"inline-flex flex-col text-left",children:e.jsxs("span",{className:"text-[11px] lg:text-xs 2xl:text-xs font-medium text-gray-900 dark:text-gray-100",children:[s?s.month_label:"Selecione um mês",s&&s.is_paid?" (paga)":""]})}),e.jsx("svg",{className:T("h-4 w-4 text-gray-500 dark:text-gray-400 transition-transform",i?"rotate-180":"rotate-0"),viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M5.25 7.5L10 12.25L14.75 7.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]}),i&&e.jsx("div",{ref:u,className:"absolute right-0 z-20 mt-2 w-64 sm:w-80 2xl:w-80 origin-top-right rounded-2xl bg-white p-3 shadow-xl ring-1 ring-black/5 dark:bg-[#050505] dark:ring-black/40",children:e.jsx(E,{maxHeightClassName:"max-h-56 2xl:max-h-56",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 mr-2",children:r.map(l=>{const f=l.month_key===(s&&s.month_key);return l.is_paid,e.jsx("button",{type:"button",onClick:()=>m(l.month_key),className:T("flex flex-col items-start rounded-xl border px-2.5 py-2 text-left transition-colors","hover:border-rose-400 hover:bg-rose-50/60 dark:hover:border-rose-500/70 dark:hover:bg-rose-900/20",f?"border-rose-500 bg-rose-50 dark:border-rose-500/80 dark:bg-rose-900/30":"border-gray-200 bg-gray-50/60 dark:border-gray-800 dark:bg-[#050505]"),children:e.jsx("span",{className:"text-sm 2xl:text-sm font-medium text-gray-800 dark:text-gray-100 leading-tight",children:l.month_label})},l.month_key)})})})})]})}function ae({bankAccounts:r=[],categories:d=[],filters:p={},months:i=[],monthValue:x,onFiltersChange:a,onMonthChange:u}){const s=p?.bank_user_id??"",m=p?.category_id??"",l=t=>{const c=t.target.value||void 0;a&&a({bank_user_id:c,category_id:m||void 0})},f=t=>{const c=t.target.value||void 0;a&&a({bank_user_id:s||void 0,category_id:c})},o=t=>{!t||!u||u(t)};return e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs sm:text-sm lg:text-sm 2xl:text-sm",children:[e.jsxs("select",{value:s||"",onChange:l,className:"min-w-[190px] sm:min-w-[210px] lg:min-w-[230px] 2xl:min-w-[230px] rounded-lg border border-gray-300 bg-white px-2.5 py-1.5 text-xs sm:text-sm 2xl:text-sm shadow-sm focus:border-rose-500 focus:ring-rose-500 dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Todos os bancos"}),r.map(t=>e.jsxs("option",{value:t.id,children:[t.name,t.due_day?` - vence todo dia ${t.due_day}`:""]},t.id))]}),e.jsxs("select",{value:m||"",onChange:f,className:"min-w-[190px] sm:min-w-[210px] lg:min-w-[230px] 2xl:min-w-[230px] rounded-lg border border-gray-300 bg-white px-2.5 py-1.5 text-xs sm:text-sm 2xl:text-sm shadow-sm focus:border-rose-500 focus:ring-rose-500 dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Todas as categorias"}),d.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),i&&i.length>0&&e.jsx(re,{months:i,value:x,onChange:o})]})}function I(r){if(!r||typeof r!="string")return 0;const[d,p]=r.split("-"),i=parseInt(d,10)||0,x=parseInt(p,10)||0;return i*12+(x-1)}function R(r,d){if(!r||r.length===0)return null;if(d){if(r.some(u=>u.month_key===d))return d;const i=I(d);let x=r[0],a=Math.abs(I(x.month_key)-i);for(const u of r){const s=Math.abs(I(u.month_key)-i);s<a&&(x=u,a=s)}return x.month_key}return r[0].month_key}function se(r="",d,p){const[i,x]=b.useState(r);return{value:i,setValue:x,handleChange:s=>{let m=s.target.value??"";m=m.replace(/[^0-9]/g,"");{const l=String(p).length;m.length>l&&(m=m.slice(0,l))}x(m)},isValid:(()=>{if(i==="")return!1;const s=parseInt(i,10);return!(Number.isNaN(s)||s<d||s>p)})(),numericValue:i===""?null:parseInt(i,10)}}function fe({monthlyGroups:r=[],bankAccounts:d=[],categories:p=[],filters:i={},currentMonthKey:x=null}){const a=b.useMemo(()=>{if(!Array.isArray(r))return[];const g=new Map;for(const y of r)!y||!y.month_key||typeof y.month_key!="string"||g.has(y.month_key)||g.set(y.month_key,y);const j=Array.from(g.values());return j.sort((y,D)=>I(y.month_key)-I(D.month_key)),j},[r]),u=i?.bank_user_id??"",[s,m]=b.useState(()=>R(a,x)),[l,f]=b.useState(!1),o=se("",1,31),[t,c]=b.useState(!1);b.useEffect(()=>{if(!a||a.length===0){m(null);return}if(!a.some(j=>j.month_key===s)){const j=R(a,x);m(j)}},[a,s,x]);const v=g=>{F.get(route("faturas.index"),g,{preserveState:!0,preserveScroll:!0})},h=d&&d.length>0&&u?d.find(g=>String(g.id)===String(u)):null,w=g=>{m(g)},S=()=>{h&&(o.setValue(h.due_day?String(h.due_day):""),f(!0))},k=async g=>{if(g.preventDefault(),!h||t)return;if(!o.isValid){C.error("Informe um dia de vencimento entre 1 e 31.");return}const j=o.numericValue;c(!0),C.dismiss();try{await $.patch(route("banks.update-due-day",h.id),{due_day:j}),C.success("Dia de vencimento atualizado com sucesso."),f(!1),F.reload({only:["bankAccounts"]})}catch(y){console.error(y),C.error("Não foi possível atualizar o dia de vencimento.")}finally{c(!1)}},_=()=>{if(!a||a.length===0||!n){F.reload({only:["monthlyGroups"],preserveState:!0});return}const g=a.findIndex(D=>D.month_key===n.month_key),j=g>0?g-1:g,y=a[j]||n;m(y.month_key),F.reload({only:["monthlyGroups"],preserveState:!0})},n=a&&a.length>0?a.find(g=>g.month_key===s)||a[0]:null,N=R(a,x);return e.jsxs(z,{children:[e.jsx(O,{title:"Faturas"}),e.jsxs("div",{className:"w-full max-w-[1500px] 2xl:max-w-[1600px] mx-auto px-3 sm:px-4 lg:px-6 2xl:px-6 space-y-4 sm:space-y-5 lg:space-y-6 2xl:space-y-6",children:[e.jsxs("header",{className:"pt-1 sm:pt-2 space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl 2xl:text-3xl font-semibold text-gray-900 mb-1 dark:text-gray-100",children:"Faturas"}),e.jsx("p",{className:"text-xs sm:text-sm lg:text-base 2xl:text-base text-gray-600 dark:text-gray-300",children:"Visualize suas despesas agrupadas por mês."})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsx(ae,{bankAccounts:d,categories:p,filters:i,months:a,monthValue:n?.month_key||s,onFiltersChange:v,onMonthChange:w}),e.jsx("div",{className:"flex justify-start md:justify-end",children:e.jsx(te,{monthlyGroups:r})})]}),h&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs sm:text-sm 2xl:text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("span",{children:["Dia de vencimento:"," ",h.due_day?`todo dia ${h.due_day}`:"ainda não definido"]}),e.jsx(M,{type:"button",onClick:S,className:"rounded-full px-4 py-1.5 text-[11px] sm:text-xs font-semibold uppercase tracking-wide text-rose-600 border border-rose-500 hover:bg-rose-50 dark:border-rose-500/70 dark:text-rose-300 dark:hover:bg-rose-900/20",children:"Definir dia de vencimento"})]})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4 lg:space-y-5 2xl:space-y-5 pb-4 sm:pb-6 2xl:pb-6",children:[(!a||a.length===0)&&e.jsx("p",{className:"text-xs sm:text-sm lg:text-base 2xl:text-base text-gray-500 dark:text-gray-400",children:"Nenhuma fatura encontrada para o filtro atual."}),a&&a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{months:a,selectedMonthKey:n?.month_key,onChangeMonth:w,...n}),n&&e.jsx(G,{...n,month_key:n.month_key,bankUserId:u||null,due_day:h?.due_day??null,onPaid:_,isCurrentPending:N&&n.month_key===N&&!n.is_paid},n.month_key)]})]}),e.jsx(V,{isOpen:l,onClose:()=>!t&&f(!1),maxWidth:"sm",title:"Definir dia de vencimento",children:e.jsxs("form",{className:"space-y-4",onSubmit:k,noValidate:!0,children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 dark:text-gray-200",children:"Dia de vencimento do cartão (1 a 31)"}),e.jsx("input",{type:"number",min:1,max:31,inputMode:"numeric",value:o.value,onChange:o.handleChange,className:"w-full rounded-md border border-gray-300 bg-white p-2 text-xs sm:text-sm shadow-sm dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-2 text-xs sm:text-xs",children:[e.jsx(M,{type:"button",onClick:()=>!t&&f(!1),className:"rounded-lg px-4 py-2 font-medium text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800",children:"Cancelar"}),e.jsx(L,{type:"submit",disabled:t,className:"rounded-lg px-4 py-2 font-semibold uppercase tracking-wide disabled:cursor-not-allowed",children:t?"Salvando...":"Salvar dia"})]})]})})]})]})}export{fe as default};
