import{r as c,j as e,a as D,y as M,H as Q}from"./app-spkBn8sA.js";import{A as W}from"./AuthenticatedLayout-yQDg9Mri.js";import{E as J}from"./ExportExcel-DXMspoEY.js";import{f as m,S as w}from"./formatters-PUzJnbjp.js";import{P as U}from"./PrimaryButton-BgCm161T.js";import{M as X}from"./Modal-Cf-5o9kr.js";import{F as Y}from"./FaturaDetailModal-D0IEVawL.js";/* empty css            */import"./proxy-AagP0K0_.js";import"./BareButton-Eeklpzbo.js";function Z({filters:t={}}){const[n,s]=c.useState([]);c.useEffect(()=>{let d=!0;return(async()=>{try{const o=await D.get(route("transacoes.export_data"),{params:{bank_user_id:t.bank_user_id||void 0,category_id:t.category_id||void 0}});if(!d)return;const h=[...Array.isArray(o.data)?o.data:[]].sort((k,i)=>{const N=k.year_month||"",b=i.year_month||"";return N===b?String(k.created_at||"").localeCompare(String(i.created_at||"")):N.localeCompare(b)});s(h)}catch(o){console.error(o),o.response?.data?.message?M.error(o.response.data.message):M.error("Não foi possível carregar as transações para exportação.")}})(),()=>{d=!1}},[t.bank_user_id,t.category_id]);const f=c.useMemo(()=>({month_label:{name:"Mês/Ano"},created_at_formatted:{name:"Data"},type:{name:"Tipo"},status:{name:"Status"},title:{name:"Título"},description:{name:"Descrição"},amount:{name:"Valor"},total_installments:{name:"Parcelas Totais"},current_installment:{name:"Parcela Atual"},is_recurring:{name:"Recorrente"},"bank_user.bank.name":{name:"Banco"},"category.name":{name:"Categoria"}}),[]);return e.jsx(J,{data:n,header:f,name:"transacoes_faturas",currencyColumns:["Valor"]})}function A(t){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).format(t||0)}function ee({items:t=[],onSelectPeriod:n}){return!t||t.length===0?e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:"Nenhuma transação encontrada para os filtros atuais."}):e.jsxs("div",{className:"mt-2 rounded-2xl bg-white p-3 sm:p-3 lg:p-4 shadow-sm ring-1 ring-black/5 dark:bg-[#080808] dark:ring-white/5",children:[e.jsx("h2",{className:"text-sm sm:text-base font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Resumo por mês / ano"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"max-h-[320px] md:max-h-[360px] lg:max-h-[400px] 2xl:max-h-[400px] overflow-y-auto",children:e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-800 text-[11px] sm:text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400",children:[e.jsx("th",{className:"py-2 pr-3 text-left",children:"Mês / Ano"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"Total geral"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"Total crédito"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"Total débito"}),e.jsx("th",{className:"py-2 pl-3 text-right",children:"Qtd. transações"}),n&&e.jsx("th",{className:"py-2 pl-3 text-right",children:"Detalhar"})]})}),e.jsx("tbody",{children:t.map(s=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800 last:border-0 hover:bg-gray-50 dark:hover:bg-gray-900/40",children:[e.jsx("td",{className:"py-1.5 pr-3 text-left text-gray-800 dark:text-gray-100 whitespace-nowrap",children:s.month_label||s.year_month||"Sem data"}),e.jsx("td",{className:"py-1.5 px-3 text-right text-gray-900 dark:text-gray-100 whitespace-nowrap",children:A(s.total_amount)}),e.jsx("td",{className:"py-1.5 px-3 text-right text-emerald-600 dark:text-emerald-400 whitespace-nowrap",children:A(s.total_credit)}),e.jsx("td",{className:"py-1.5 px-3 text-right text-rose-600 dark:text-rose-400 whitespace-nowrap",children:A(s.total_debit)}),e.jsx("td",{className:"py-1.5 pl-3 text-right text-gray-700 dark:text-gray-200 whitespace-nowrap",children:s.count}),n&&e.jsx("td",{className:"py-1.5 pl-3 pr-2 text-right",children:e.jsx("button",{type:"button",onClick:()=>n(s.year_month),className:"inline-flex items-center rounded-full border border-rose-500 px-2.5 py-1 text-[10px] sm:text-[11px] font-semibold uppercase tracking-wide text-rose-600 transition hover:bg-rose-50 dark:border-rose-500/70 dark:text-rose-300 dark:hover:bg-rose-900/20",children:"Ver período"})})]},s.year_month||s.month_label))})]})})})]})}function te({periods:t=[],selectedKey:n,onChange:s,onOpen:f,isLoading:d=!1}){const y=t&&t.length>0,o=n||(y?t[t.length-1]?.key:"");return e.jsxs("div",{className:"rounded-2xl bg-white p-3 shadow-md ring-1 ring-black/5 dark:bg-[#0b0b0b] dark:ring-black/30 sm:p-3 lg:p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Fatura por período"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-300 mt-1",children:"Escolha um mês/ano para visualizar a fatura e todas as transações daquele período."})]}),d&&e.jsx("span",{className:"text-[11px] sm:text-xs text-gray-500 dark:text-gray-400",children:"Carregando..."})]}),e.jsxs("div",{className:"mt-3 flex flex-col gap-2 sm:flex-row sm:items-stretch",children:[e.jsx("select",{value:o,onChange:u=>s?.(u.target.value),disabled:!y||d,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-xs sm:text-sm shadow-sm focus:border-rose-500 focus:ring-rose-500 dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100 sm:min-w-[230px]",children:y?t.map(u=>e.jsxs("option",{value:u.key,children:[u.label," — ",u.count," transações"]},u.key)):e.jsx("option",{value:"",children:"Nenhum período disponível"})}),e.jsx(U,{type:"button",onClick:()=>f?.(o),disabled:!y||!o||d,className:"h-[42px] sm:h-[42px] rounded-full px-4 text-[11px] sm:text-xs font-semibold uppercase tracking-wide w-full sm:w-auto flex items-center justify-center whitespace-nowrap",children:"Ver fatura"})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-2 sm:grid-cols-2 text-xs sm:text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("p",{children:["Períodos detectados: ",e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t.length})]}),e.jsxs("p",{className:"sm:text-right",children:["Último período: ",y?t[t.length-1]?.label:"-"]})]})]})}function ae({isOpen:t,onClose:n,period:s,onSelectTransaction:f}){if(!s)return null;const{label:d,total_credit:y,total_debit:o,total_amount:u,transactions:h=[]}=s,k=h.filter(r=>r.status==="paid").length,i=h.filter(r=>r.status==="overdue").length,N=h.length-k-i,b=h.length>10;return e.jsx(X,{isOpen:t,onClose:n,maxWidth:"4xl",title:`Fatura de ${d}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(E,{label:"Total do período",value:m(u),emphasize:!0}),e.jsx(E,{label:"Total crédito",value:m(y),tone:"credit"}),e.jsx(E,{label:"Total débito",value:m(o),tone:"debit"}),e.jsx(E,{label:"Status",value:`${k} pagos • ${N} em aberto${i?` • ${i} vencidos`:""}`})]}),e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white shadow-sm ring-1 ring-black/5 dark:border-gray-800 dark:bg-[#080808] dark:ring-white/5",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 sm:px-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold text-gray-900 dark:text-gray-100",children:"Transações do período"}),e.jsxs("p",{className:"text-[11px] sm:text-xs text-gray-500 dark:text-gray-400",children:[h.length," item(s)"]})]}),b&&e.jsx("span",{className:"text-[11px] sm:text-xs text-gray-500 dark:text-gray-400",children:"Rolagem ativada (mais de 10 registros)"})]}),h.length===0?e.jsx("p",{className:"px-4 pb-4 text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:"Nenhuma transação encontrada."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:b?"max-h-[440px] md:max-h-[520px] lg:max-h-[560px] overflow-y-auto":"",children:e.jsxs("table",{className:"min-w-full text-[11px] sm:text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-800 text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Título"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Tipo"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Valor período"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Valor total"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Banco"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Categoria"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Data"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-800",children:h.map(r=>{const T=r.type==="credit"?r.installment_amount??r.amount:r.amount,R=r.status==="paid"?"Pago":r.status==="overdue"?"Vencido":"Em aberto",P=r.type==="credit"?"Crédito":"Débito";return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-900/40 cursor-pointer",onClick:()=>f?.(r),children:[e.jsx("td",{className:"px-3 py-2 text-gray-900 dark:text-gray-100 whitespace-nowrap",children:r.title}),e.jsx("td",{className:"px-3 py-2 text-gray-700 dark:text-gray-200 whitespace-nowrap",children:P}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx("span",{className:"rounded-full px-2.5 py-0.5 text-[10px] font-semibold "+(r.status==="paid"?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-300":r.status==="overdue"?"bg-rose-100 text-rose-700 dark:bg-rose-900/40 dark:text-rose-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300"),children:R})}),e.jsx("td",{className:"px-3 py-2 text-right text-rose-600 dark:text-rose-400 whitespace-nowrap",children:m(T)}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-900 dark:text-gray-100 whitespace-nowrap",children:m(r.amount)}),e.jsx("td",{className:"px-3 py-2 text-gray-700 dark:text-gray-200 whitespace-nowrap",children:r.bank_name||"-"}),e.jsx("td",{className:"px-3 py-2 text-gray-700 dark:text-gray-200 whitespace-nowrap",children:r.category_name||"-"}),e.jsx("td",{className:"px-3 py-2 text-gray-700 dark:text-gray-200 whitespace-nowrap",children:se(r.created_at)})]},r.id)})})]})})})]})]})})}function E({label:t,value:n,tone:s,emphasize:f=!1}){const d=s==="credit"?"text-emerald-600 dark:text-emerald-400":s==="debit"?"text-rose-600 dark:text-rose-400":"text-gray-900 dark:text-gray-100";return e.jsxs("div",{className:"rounded-xl border border-gray-100 bg-gray-50/80 px-3 py-2 shadow-sm dark:border-gray-800 dark:bg-gray-900/60",children:[e.jsx("p",{className:"text-[11px] sm:text-xs font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300",children:t}),e.jsx("p",{className:`text-sm sm:text-base font-bold ${f?"text-gray-900 dark:text-gray-100":d}`,children:n})]})}function se(t){if(!t)return"-";const n=new Date(t);return Number.isNaN(n.getTime())?"-":n.toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"})}function re({insights:t}){const n=[{label:"Saldo líquido (pagos)",value:m(t.netBalance||0),helper:"Receitas pagas - despesas pagas"},{label:"Ticket médio",value:t.averageTicket?m(t.averageTicket):"-",helper:"Valor médio por transação no período filtrado"},{label:"Mês de maior gasto",value:t.topExpenseLabel||"-",helper:t.topExpenseValue?m(t.topExpenseValue):"Sem histórico"}];return e.jsxs("div",{className:"rounded-2xl bg-white p-3 shadow-md ring-1 ring-black/5 dark:bg-[#0b0b0b] dark:ring-black/30 sm:p-3 lg:p-4",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Insights rápidos"}),e.jsx("div",{className:"mt-3 grid grid-cols-1 gap-2 sm:grid-cols-3",children:n.map(s=>e.jsxs("div",{className:"rounded-xl border border-gray-100 bg-gray-50/70 px-3 py-2 shadow-sm dark:border-gray-800 dark:bg-gray-900/60",children:[e.jsx("p",{className:"text-[11px] sm:text-xs font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300",children:s.label}),e.jsx("p",{className:"text-sm sm:text-base font-bold text-gray-900 dark:text-gray-100",children:s.value}),e.jsx("p",{className:"text-[11px] sm:text-xs text-gray-500 dark:text-gray-400",children:s.helper})]},s.label))})]})}function ye({bankAccounts:t=[],categories:n=[]}){const[s,f]=c.useState(""),[d,y]=c.useState(""),[o,u]=c.useState({total_income:0,total_expenses:0,pending_income:0,pending_expenses:0,current_month_debit_total:0,overdue_count:0}),[h,k]=c.useState([]),[i,N]=c.useState([]),[b,r]=c.useState(""),[T,R]=c.useState(null),[P,B]=c.useState(!1),[V,I]=c.useState(!1);c.useEffect(()=>{let l=!0;return(async()=>{I(!0);try{const[_,S]=await Promise.all([D.get(route("transacoes.stats"),{params:{bank_user_id:s||void 0,category_id:d||void 0}}),D.get(route("transacoes.export_data"),{params:{bank_user_id:s||void 0,category_id:d||void 0}})]);if(!l)return;const p=_.data||{};u({total_income:Number(p.total_income||0),total_expenses:Number(p.total_expenses||0),pending_income:Number(p.pending_income||0),pending_expenses:Number(p.pending_expenses||0),current_month_debit_total:Number(p.current_month_debit_total||0),overdue_count:Number(p.overdue_count||0)});const j=a=>{const x=a.invoice_month||a.year_month||"sem-data",g=a.invoice_month_label||a.month_label||"Sem data";return{...a,period_key:x,period_label:g,bank_name:a.bank_user?.bank?.name||"Sem banco",category_name:a.category?.name||"Sem categoria",display_installment:a.display_installment||a.current_installment,installment_amount:Number(a.installment_amount??a.amount??0),amount:Number(a.amount||0)}},K=(Array.isArray(S.data)?S.data:[]).map(j).reduce((a,x)=>{const g=x.period_key;a[g]||(a[g]={key:g,label:x.period_label,total_amount:0,total_credit:0,total_debit:0,count:0,transactions:[]});const G=x.type==="debit"&&x.amount||0,H=x.type==="credit"&&x.installment_amount||0;return a[g].total_debit+=G,a[g].total_credit+=H,a[g].total_amount=a[g].total_credit+a[g].total_debit,a[g].count+=1,a[g].transactions.push(x),a},{}),C=Object.values(K).sort((a,x)=>(a.key||"").localeCompare(x.key||""));N(C),k(C.map(a=>({year_month:a.key,month_label:a.label,total_amount:a.total_amount,total_credit:a.total_credit,total_debit:a.total_debit,count:a.count})));const q=C[C.length-1]?.key||"";r(a=>C.some(x=>x.key===a)?a:q)}catch(_){console.error(_),_.response?.data?.message?M.error(_.response.data.message):M.error("Não foi possível carregar os dados do relatório.")}finally{l&&I(!1)}})(),()=>{l=!1}},[s,d]);const F=c.useMemo(()=>i.find(l=>l.key===b)||null,[i,b]),O=c.useMemo(()=>{const l=i.reduce((p,j)=>p+(j.total_amount||0),0),v=i.reduce((p,j)=>p+(Array.isArray(j.transactions)?j.transactions.length:0),0),_=v>0?l/v:0,S=[...i].sort((p,j)=>(j.total_amount||0)-(p.total_amount||0))[0];return{netBalance:(o.total_income||0)-(o.total_expenses||0),averageTicket:_,topExpenseLabel:S?.label||"",topExpenseValue:S?.total_amount||0}},[i,o.total_expenses,o.total_income]),L=l=>{const v=l||b||i[i.length-1]?.key||"";v&&(r(v),B(!0))},$=()=>{B(!1)},z=l=>{R(l)};return e.jsxs(W,{children:[e.jsx(Q,{title:"Relatórios"}),e.jsxs("div",{className:"w-full max-w-[1450px] 2xl:max-w-[1500px] mx-auto px-3 py-3 space-y-4 sm:px-4 sm:py-4 lg:px-6 lg:py-5",children:[e.jsxs("header",{className:"space-y-1.5 pt-0.5 sm:pt-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-semibold text-gray-900 dark:text-gray-100",children:"Relatórios"}),e.jsx("p",{className:"text-xs sm:text-sm lg:text-base text-gray-600 dark:text-gray-300 max-w-3xl",children:"Acompanhe todas as suas transações em faturas, veja um resumo financeiro por período, filtre por conta e categoria e exporte um arquivo Excel completo."})]}),e.jsx("section",{className:"rounded-2xl bg-white p-3 shadow-md ring-1 ring-black/5 dark:bg-[#0b0b0b] dark:ring-black/30 sm:p-3 lg:p-4 space-y-3",children:e.jsxs("div",{className:"flex flex-col gap-2 text-xs sm:text-sm sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[e.jsx("div",{className:"flex w-full flex-col gap-1 sm:w-auto sm:flex-row sm:items-center sm:gap-2",children:e.jsxs("select",{value:s,onChange:l=>f(l.target.value),className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-xs sm:text-sm shadow-sm focus:border-rose-500 focus:ring-rose-500 dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100 sm:min-w-[200px]",children:[e.jsx("option",{value:"",children:"Todos"}),t.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})}),e.jsx("div",{className:"flex w-full flex-col gap-1 sm:w-auto sm:flex-row sm:items-center sm:gap-2",children:e.jsxs("select",{value:d,onChange:l=>y(l.target.value),className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-xs sm:text-sm shadow-sm focus:border-rose-500 focus:ring-rose-500 dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100 sm:min-w-[200px]",children:[e.jsx("option",{value:"",children:"Todas"}),n.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})})]}),e.jsx("div",{className:"flex justify-end w-full sm:w-auto",children:e.jsx(Z,{filters:{bank_user_id:s||void 0,category_id:d||void 0}})})]})}),e.jsxs("section",{className:"grid grid-cols-1 gap-3 lg:grid-cols-2",children:[e.jsx(te,{periods:i,selectedKey:b,onChange:r,onOpen:L,isLoading:V}),e.jsx(re,{insights:O})]}),e.jsxs("section",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx(w,{title:"Receitas pagas",value:m(o.total_income)}),e.jsx(w,{title:"Despesas pagas",value:m(o.total_expenses)}),e.jsx(w,{title:"Receitas pendentes",value:m(o.pending_income)}),e.jsx(w,{title:"Despesas pendentes",value:m(o.pending_expenses)}),e.jsx(w,{title:"Transações no débito (mês atual)",value:m(o.current_month_debit_total)}),e.jsx(w,{title:"Faturas vencidas",value:o.overdue_count})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Resumo por mês / ano"}),V&&e.jsx("span",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:"Carregando dados..."})]}),e.jsx(ee,{items:h,onSelectPeriod:L})]}),e.jsx(ae,{isOpen:P,onClose:$,period:F,onSelectTransaction:z}),e.jsx(Y,{isOpen:!!T,onClose:()=>R(null),item:T})]})]})}export{ye as default};
