import{r as l,j as e,a as N,y as f,H as A}from"./app-Zo33inHR.js";import{A as E}from"./AuthenticatedLayout-0SC2YidR.js";import{E as T}from"./ExportExcel-h4M97tCt.js";import{S as x,f as h}from"./formatters-Bq2iFqoM.js";/* empty css            */import"./proxy-DNuHlVw4.js";import"./BareButton-BpOYl9pL.js";import"./Tooltip-C_Gv0z5R.js";function B({filters:s={}}){const[r,m]=l.useState([]);l.useEffect(()=>{let d=!0;return(async()=>{try{const a=await N.get(route("faturas.export_data"),{params:{bank_user_id:s.bank_user_id||void 0,category_id:s.category_id||void 0}});if(!d)return;const j=[...Array.isArray(a.data)?a.data:[]].sort((y,_)=>{const p=y.year_month||"",t=_.year_month||"";return p===t?String(y.created_at||"").localeCompare(String(_.created_at||"")):p.localeCompare(t)});m(j)}catch(a){console.error(a),a.response?.data?.message?f.error(a.response.data.message):f.error("Não foi possível carregar as transações para exportação.")}})(),()=>{d=!1}},[s.bank_user_id,s.category_id]);const b=l.useMemo(()=>({month_label:{name:"Mês/Ano"},created_at_formatted:{name:"Data"},type:{name:"Tipo"},status:{name:"Status"},title:{name:"Título"},description:{name:"Descrição"},amount:{name:"Valor"},total_installments:{name:"Parcelas Totais"},current_installment:{name:"Parcela Atual"},is_recurring:{name:"Recorrente"},"bank_user.bank.name":{name:"Banco"},"category.name":{name:"Categoria"}}),[]);return e.jsx(T,{data:r,header:b,name:"transacoes_faturas",currencyColumns:["Valor"]})}function v(s){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).format(s||0)}function D({items:s=[]}){return!s||s.length===0?e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:"Nenhuma transação encontrada para os filtros atuais."}):e.jsxs("div",{className:"mt-2 rounded-2xl bg-white p-3 sm:p-3 lg:p-4 shadow-sm ring-1 ring-black/5 dark:bg-[#080808] dark:ring-white/5",children:[e.jsx("h2",{className:"text-sm sm:text-base font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Resumo por mês / ano"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"max-h-[320px] md:max-h-[360px] lg:max-h-[400px] 2xl:max-h-[400px] overflow-y-auto",children:e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-800 text-[11px] sm:text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400",children:[e.jsx("th",{className:"py-2 pr-3 text-left",children:"Mês / Ano"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"Total geral"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"Total crédito"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"Total débito"}),e.jsx("th",{className:"py-2 pl-3 text-right",children:"Qtd. transações"})]})}),e.jsx("tbody",{children:s.map(r=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800 last:border-0 hover:bg-gray-50 dark:hover:bg-gray-900/40",children:[e.jsx("td",{className:"py-1.5 pr-3 text-left text-gray-800 dark:text-gray-100 whitespace-nowrap",children:r.month_label||r.year_month||"Sem data"}),e.jsx("td",{className:"py-1.5 px-3 text-right text-gray-900 dark:text-gray-100 whitespace-nowrap",children:v(r.total_amount)}),e.jsx("td",{className:"py-1.5 px-3 text-right text-emerald-600 dark:text-emerald-400 whitespace-nowrap",children:v(r.total_credit)}),e.jsx("td",{className:"py-1.5 px-3 text-right text-rose-600 dark:text-rose-400 whitespace-nowrap",children:v(r.total_debit)}),e.jsx("td",{className:"py-1.5 pl-3 text-right text-gray-700 dark:text-gray-200 whitespace-nowrap",children:r.count})]},r.year_month||r.month_label))})]})})})]})}function z({bankAccounts:s=[],categories:r=[]}){const[m,b]=l.useState(""),[d,k]=l.useState(""),[a,w]=l.useState({total_income:0,total_expenses:0,pending_income:0,pending_expenses:0,current_month_debit_total:0,overdue_count:0}),[j,y]=l.useState([]),[_,p]=l.useState(!1);return l.useEffect(()=>{let t=!0;return(async()=>{p(!0);try{const[u,S]=await Promise.all([N.get(route("faturas.stats"),{params:{bank_user_id:m||void 0,category_id:d||void 0}}),N.get(route("faturas.export_data"),{params:{bank_user_id:m||void 0,category_id:d||void 0}})]);if(!t)return;const c=u.data||{};w({total_income:Number(c.total_income||0),total_expenses:Number(c.total_expenses||0),pending_income:Number(c.pending_income||0),pending_expenses:Number(c.pending_expenses||0),current_month_debit_total:Number(c.current_month_debit_total||0),overdue_count:Number(c.overdue_count||0)});const R=(Array.isArray(S.data)?S.data:[]).reduce((o,n)=>{const i=n.year_month||"sem-data";o[i]||(o[i]={year_month:n.year_month||null,month_label:n.month_label||n.year_month||"Sem data",total_amount:0,total_credit:0,total_debit:0,count:0});const g=Number(n.amount||0);return o[i].total_amount+=g,n.type==="credit"?o[i].total_credit+=g:n.type==="debit"&&(o[i].total_debit+=g),o[i].count+=1,o},{}),C=Object.values(R).sort((o,n)=>{const i=o.year_month||"",g=n.year_month||"";return i.localeCompare(g)});y(C)}catch(u){console.error(u),u.response?.data?.message?f.error(u.response.data.message):f.error("Não foi possível carregar os dados do relatório.")}finally{t&&p(!1)}})(),()=>{t=!1}},[m,d]),e.jsxs(E,{children:[e.jsx(A,{title:"Relatórios"}),e.jsxs("div",{className:"w-full max-w-[1450px] 2xl:max-w-[1500px] mx-auto px-3 py-3 space-y-4 sm:px-4 sm:py-4 lg:px-6 lg:py-5",children:[e.jsxs("header",{className:"space-y-1.5 pt-0.5 sm:pt-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-semibold text-gray-900 dark:text-gray-100",children:"Relatórios"}),e.jsx("p",{className:"text-xs sm:text-sm lg:text-base text-gray-600 dark:text-gray-300 max-w-3xl",children:"Acompanhe todas as suas transações em faturas, veja um resumo financeiro por período, filtre por conta e categoria e exporte um arquivo Excel completo."})]}),e.jsx("section",{className:"rounded-2xl bg-white p-3 shadow-md ring-1 ring-black/5 dark:bg-[#0b0b0b] dark:ring-black/30 sm:p-3 lg:p-4 space-y-3",children:e.jsxs("div",{className:"flex flex-col gap-2 text-xs sm:text-sm sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[e.jsx("div",{className:"flex w-full flex-col gap-1 sm:w-auto sm:flex-row sm:items-center sm:gap-2",children:e.jsxs("select",{value:m,onChange:t=>b(t.target.value),className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-xs sm:text-sm shadow-sm focus:border-rose-500 focus:ring-rose-500 dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100 sm:min-w-[200px]",children:[e.jsx("option",{value:"",children:"Todos"}),s.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})}),e.jsx("div",{className:"flex w-full flex-col gap-1 sm:w-auto sm:flex-row sm:items-center sm:gap-2",children:e.jsxs("select",{value:d,onChange:t=>k(t.target.value),className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-xs sm:text-sm shadow-sm focus:border-rose-500 focus:ring-rose-500 dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100 sm:min-w-[200px]",children:[e.jsx("option",{value:"",children:"Todas"}),r.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})})]}),e.jsx("div",{className:"flex justify-end w-full sm:w-auto",children:e.jsx(B,{filters:{bank_user_id:m||void 0,category_id:d||void 0}})})]})}),e.jsxs("section",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx(x,{title:"Receitas pagas",value:h(a.total_income)}),e.jsx(x,{title:"Despesas pagas",value:h(a.total_expenses)}),e.jsx(x,{title:"Receitas pendentes",value:h(a.pending_income)}),e.jsx(x,{title:"Despesas pendentes",value:h(a.pending_expenses)}),e.jsx(x,{title:"Transações no débito (mês atual)",value:h(a.current_month_debit_total)}),e.jsx(x,{title:"Faturas vencidas",value:a.overdue_count})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Resumo por mês / ano"}),_&&e.jsx("span",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:"Carregando dados..."})]}),e.jsx(D,{items:j})]})]})]})}export{z as default};
