import{r as i,j as e,a as M,y as R,H as W}from"./app-D3a6aWwH.js";import{A as J}from"./AuthenticatedLayout-DaxJmqFY.js";import{E as U}from"./ExportExcel-DmGVjrJ9.js";import{f as x,S as w}from"./formatters-Bc8JqMEo.js";import{P as X}from"./PrimaryButton-04MiqHnh.js";import{M as Y}from"./Modal-CbD6eOEa.js";import{S as Z}from"./ScrollArea-DmGezmAp.js";import{F as ee}from"./FaturaDetailModal-B4Vo8zQs.js";/* empty css            */import"./proxy-C_6h7FEh.js";import"./BareButton-CH1oiQit.js";function te({filters:a={}}){const[l,t]=i.useState([]);i.useEffect(()=>{let n=!0;return(async()=>{try{const r=await M.get(route("transacoes.export_data"),{params:{bank_user_id:a.bank_user_id||void 0,category_id:a.category_id||void 0}});if(!n)return;const g=[...Array.isArray(r.data)?r.data:[]].sort((j,d)=>{const N=j.year_month||"",b=d.year_month||"";return N===b?String(j.created_at||"").localeCompare(String(d.created_at||"")):N.localeCompare(b)});t(g)}catch(r){console.error(r),r.response?.data?.message?R.error(r.response.data.message):R.error("Não foi possível carregar as transações para exportação.")}})(),()=>{n=!1}},[a.bank_user_id,a.category_id]);const m=i.useMemo(()=>({month_label:{name:"Mês/Ano"},created_at_formatted:{name:"Data"},type:{name:"Tipo"},status:{name:"Status"},title:{name:"Título"},description:{name:"Descrição"},amount:{name:"Valor"},total_installments:{name:"Parcelas Totais"},current_installment:{name:"Parcela Atual"},is_recurring:{name:"Recorrente"},"bank_user.bank.name":{name:"Banco"},"category.name":{name:"Categoria"}}),[]);return e.jsx(U,{data:l,header:m,name:"transacoes_faturas",currencyColumns:["Valor"]})}function E(a){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).format(a||0)}function ae({items:a=[],onSelectPeriod:l}){return!a||a.length===0?e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:"Nenhuma transação encontrada para os filtros atuais."}):e.jsxs("div",{className:"mt-2 rounded-2xl bg-white p-3 sm:p-3 lg:p-4 shadow-sm ring-1 ring-black/5 dark:bg-[#080808] dark:ring-white/5",children:[e.jsx("h2",{className:"text-sm sm:text-base font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Resumo por mês / ano"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"max-h-[320px] md:max-h-[360px] lg:max-h-[400px] 2xl:max-h-[400px] overflow-y-auto",children:e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-800 text-[11px] sm:text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400",children:[e.jsx("th",{className:"py-2 pr-3 text-left",children:"Mês / Ano"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"Total geral"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"Total crédito"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"Total débito"}),e.jsx("th",{className:"py-2 pl-3 text-right",children:"Qtd. transações"}),l&&e.jsx("th",{className:"py-2 pl-3 text-right",children:"Detalhar"})]})}),e.jsx("tbody",{children:a.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800 last:border-0 hover:bg-gray-50 dark:hover:bg-gray-900/40",children:[e.jsx("td",{className:"py-1.5 pr-3 text-left text-gray-800 dark:text-gray-100 whitespace-nowrap",children:t.month_label||t.year_month||"Sem data"}),e.jsx("td",{className:"py-1.5 px-3 text-right text-gray-900 dark:text-gray-100 whitespace-nowrap",children:E(t.total_amount)}),e.jsx("td",{className:"py-1.5 px-3 text-right text-emerald-600 dark:text-emerald-400 whitespace-nowrap",children:E(t.total_credit)}),e.jsx("td",{className:"py-1.5 px-3 text-right text-rose-600 dark:text-rose-400 whitespace-nowrap",children:E(t.total_debit)}),e.jsx("td",{className:"py-1.5 pl-3 text-right text-gray-700 dark:text-gray-200 whitespace-nowrap",children:t.count}),l&&e.jsx("td",{className:"py-1.5 pl-3 pr-2 text-right",children:e.jsx("button",{type:"button",onClick:()=>l(t.year_month),className:"inline-flex items-center rounded-full border border-rose-500 px-2.5 py-1 text-[10px] sm:text-[11px] font-semibold uppercase tracking-wide text-rose-600 transition hover:bg-rose-50 dark:border-rose-500/70 dark:text-rose-300 dark:hover:bg-rose-900/20",children:"Ver período"})})]},t.year_month||t.month_label))})]})})})]})}function se({periods:a=[],selectedKey:l,onChange:t,onOpen:m,isLoading:n=!1}){const p=a&&a.length>0,r=l||(p?a[a.length-1]?.key:"");return e.jsxs("div",{className:"rounded-2xl bg-white p-3 shadow-md ring-1 ring-black/5 dark:bg-[#0b0b0b] dark:ring-black/30 sm:p-3 lg:p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Fatura por período"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-300 mt-1",children:"Escolha um mês/ano para visualizar a fatura e todas as transações daquele período."})]}),n&&e.jsx("span",{className:"text-[11px] sm:text-xs text-gray-500 dark:text-gray-400",children:"Carregando..."})]}),e.jsxs("div",{className:"mt-3 flex flex-col gap-2 sm:flex-row sm:items-stretch",children:[e.jsx("select",{value:r,onChange:y=>t?.(y.target.value),disabled:!p||n,className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-xs sm:text-sm shadow-sm focus:border-rose-500 focus:ring-rose-500 dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100 sm:min-w-[230px]",children:p?a.map(y=>e.jsxs("option",{value:y.key,children:[y.label," — ",y.count," transações"]},y.key)):e.jsx("option",{value:"",children:"Nenhum período disponível"})}),e.jsx(X,{type:"button",onClick:()=>m?.(r),disabled:!p||!r||n,className:"h-[42px] sm:h-[42px] rounded-full px-4 text-[11px] sm:text-xs font-semibold uppercase tracking-wide w-full sm:w-auto flex items-center justify-center whitespace-nowrap",children:"Ver fatura"})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-2 sm:grid-cols-2 text-xs sm:text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("p",{children:["Períodos detectados: ",e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a.length})]}),e.jsxs("p",{className:"sm:text-right",children:["Último período: ",p?a[a.length-1]?.label:"-"]})]})]})}function re({isOpen:a,onClose:l,period:t,onSelectTransaction:m}){if(!t)return null;const{label:n,total_credit:p,total_debit:r,total_amount:y,transactions:g=[]}=t,j=g.filter(k=>k.status==="paid").length,d=g.filter(k=>k.status==="overdue").length,N=g.length-j-d,b=g.length>10;return e.jsx(Y,{isOpen:a,onClose:l,maxWidth:"4xl",title:`Fatura de ${n}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(T,{label:"Total do período",value:x(y),emphasize:!0}),e.jsx(T,{label:"Total crédito",value:x(p),tone:"credit"}),e.jsx(T,{label:"Total débito",value:x(r),tone:"debit"}),e.jsx(T,{label:"Status",value:`${j} pagos • ${N} em aberto${d?` • ${d} vencidos`:""}`})]}),e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white shadow-sm ring-1 ring-black/5 dark:border-gray-800 dark:bg-[#080808] dark:ring-white/5",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 sm:px-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold text-gray-900 dark:text-gray-100",children:"Transações do período"}),e.jsxs("p",{className:"text-[11px] sm:text-xs text-gray-500 dark:text-gray-400",children:[g.length," item(s)"]})]}),b&&e.jsx("span",{className:"text-[11px] sm:text-xs text-gray-500 dark:text-gray-400",children:"Rolagem ativada (mais de 10 registros)"})]}),g.length===0?e.jsx("p",{className:"px-4 pb-4 text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:"Nenhuma transação encontrada."}):e.jsx("div",{className:"overflow-x-auto",children:b?e.jsx(Z,{maxHeightClassName:"max-h-[360px] md:max-h-[380px] lg:max-h-[400px]",children:e.jsx(L,{transactions:g,onSelectTransaction:m})}):e.jsx(L,{transactions:g,onSelectTransaction:m})})]})]})})}function L({transactions:a,onSelectTransaction:l}){return e.jsxs("table",{className:"min-w-full text-[11px] sm:text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-800 text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Título"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Tipo"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Valor período"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Valor total"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Banco"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Categoria"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Data"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-800",children:a.map(t=>{const m=t.type==="credit"?t.installment_amount??t.amount:t.amount,n=t.status==="paid"?"Pago":t.status==="overdue"?"Vencido":"Em aberto",p=t.type==="credit"?"Crédito":"Débito";return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-900/40 cursor-pointer",onClick:()=>l?.(t),children:[e.jsx("td",{className:"px-3 py-2 text-gray-900 dark:text-gray-100 whitespace-nowrap",children:t.title}),e.jsx("td",{className:"px-3 py-2 text-gray-700 dark:text-gray-200 whitespace-nowrap",children:p}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx("span",{className:"rounded-full px-2.5 py-0.5 text-[10px] font-semibold "+(t.status==="paid"?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-300":t.status==="overdue"?"bg-rose-100 text-rose-700 dark:bg-rose-900/40 dark:text-rose-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300"),children:n})}),e.jsx("td",{className:"px-3 py-2 text-right text-rose-600 dark:text-rose-400 whitespace-nowrap",children:x(m)}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-900 dark:text-gray-100 whitespace-nowrap",children:x(t.amount)}),e.jsx("td",{className:"px-3 py-2 text-gray-700 dark:text-gray-200 whitespace-nowrap",children:t.bank_name||"-"}),e.jsx("td",{className:"px-3 py-2 text-gray-700 dark:text-gray-200 whitespace-nowrap",children:t.category_name||"-"}),e.jsx("td",{className:"px-3 py-2 text-gray-700 dark:text-gray-200 whitespace-nowrap",children:oe(t.created_at)})]},t.id)})})]})}function T({label:a,value:l,tone:t,emphasize:m=!1}){const n=t==="credit"?"text-emerald-600 dark:text-emerald-400":t==="debit"?"text-rose-600 dark:text-rose-400":"text-gray-900 dark:text-gray-100";return e.jsxs("div",{className:"rounded-xl border border-gray-100 bg-gray-50/80 px-3 py-2 shadow-sm dark:border-gray-800 dark:bg-gray-900/60",children:[e.jsx("p",{className:"text-[11px] sm:text-xs font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300",children:a}),e.jsx("p",{className:`text-sm sm:text-base font-bold ${m?"text-gray-900 dark:text-gray-100":n}`,children:l})]})}function oe(a){if(!a)return"-";const l=new Date(a);return Number.isNaN(l.getTime())?"-":l.toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"})}function le({insights:a}){const l=[{label:"Saldo líquido (pagos)",value:x(a.netBalance||0),helper:"Receitas pagas - despesas pagas"},{label:"Ticket médio",value:a.averageTicket?x(a.averageTicket):"-",helper:"Valor médio por transação no período filtrado"},{label:"Mês de maior gasto",value:a.topExpenseLabel||"-",helper:a.topExpenseValue?x(a.topExpenseValue):"Sem histórico"}];return e.jsxs("div",{className:"rounded-2xl bg-white p-3 shadow-md ring-1 ring-black/5 dark:bg-[#0b0b0b] dark:ring-black/30 sm:p-3 lg:p-4",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Insights rápidos"}),e.jsx("div",{className:"mt-3 grid grid-cols-1 gap-2 sm:grid-cols-3",children:l.map(t=>e.jsxs("div",{className:"rounded-xl border border-gray-100 bg-gray-50/70 px-3 py-2 shadow-sm dark:border-gray-800 dark:bg-gray-900/60",children:[e.jsx("p",{className:"text-[11px] sm:text-xs font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300",children:t.label}),e.jsx("p",{className:"text-sm sm:text-base font-bold text-gray-900 dark:text-gray-100",children:t.value}),e.jsx("p",{className:"text-[11px] sm:text-xs text-gray-500 dark:text-gray-400",children:t.helper})]},t.label))})]})}function je({bankAccounts:a=[],categories:l=[]}){const[t,m]=i.useState(""),[n,p]=i.useState(""),[r,y]=i.useState({total_income:0,total_expenses:0,pending_income:0,pending_expenses:0,current_month_debit_total:0,overdue_count:0}),[g,j]=i.useState([]),[d,N]=i.useState([]),[b,k]=i.useState(""),[P,A]=i.useState(null),[F,D]=i.useState(!1),[B,V]=i.useState(!1);i.useEffect(()=>{let o=!0;return(async()=>{V(!0);try{const[_,S]=await Promise.all([M.get(route("transacoes.stats"),{params:{bank_user_id:t||void 0,category_id:n||void 0}}),M.get(route("transacoes.export_data"),{params:{bank_user_id:t||void 0,category_id:n||void 0}})]);if(!o)return;const u=_.data||{};y({total_income:Number(u.total_income||0),total_expenses:Number(u.total_expenses||0),pending_income:Number(u.pending_income||0),pending_expenses:Number(u.pending_expenses||0),current_month_debit_total:Number(u.current_month_debit_total||0),overdue_count:Number(u.overdue_count||0)});const f=s=>{const c=s.invoice_month||s.year_month||"sem-data",h=s.invoice_month_label||s.month_label||"Sem data";return{...s,period_key:c,period_label:h,bank_name:s.bank_user?.bank?.name||"Sem banco",category_name:s.category?.name||"Sem categoria",display_installment:s.display_installment||s.current_installment,installment_amount:Number(s.installment_amount??s.amount??0),amount:Number(s.amount||0)}},q=(Array.isArray(S.data)?S.data:[]).map(f).reduce((s,c)=>{const h=c.period_key;s[h]||(s[h]={key:h,label:c.period_label,total_amount:0,total_credit:0,total_debit:0,count:0,transactions:[]});const H=c.type==="debit"&&c.amount||0,Q=c.type==="credit"&&c.installment_amount||0;return s[h].total_debit+=H,s[h].total_credit+=Q,s[h].total_amount=s[h].total_credit+s[h].total_debit,s[h].count+=1,s[h].transactions.push(c),s},{}),C=Object.values(q).sort((s,c)=>(s.key||"").localeCompare(c.key||""));N(C),j(C.map(s=>({year_month:s.key,month_label:s.label,total_amount:s.total_amount,total_credit:s.total_credit,total_debit:s.total_debit,count:s.count})));const G=C[C.length-1]?.key||"";k(s=>C.some(c=>c.key===s)?s:G)}catch(_){console.error(_),_.response?.data?.message?R.error(_.response.data.message):R.error("Não foi possível carregar os dados do relatório.")}finally{o&&V(!1)}})(),()=>{o=!1}},[t,n]);const O=i.useMemo(()=>d.find(o=>o.key===b)||null,[d,b]),$=i.useMemo(()=>{const o=d.reduce((u,f)=>u+(f.total_amount||0),0),v=d.reduce((u,f)=>u+(Array.isArray(f.transactions)?f.transactions.length:0),0),_=v>0?o/v:0,S=[...d].sort((u,f)=>(f.total_amount||0)-(u.total_amount||0))[0];return{netBalance:(r.total_income||0)-(r.total_expenses||0),averageTicket:_,topExpenseLabel:S?.label||"",topExpenseValue:S?.total_amount||0}},[d,r.total_expenses,r.total_income]),I=o=>{const v=o||b||d[d.length-1]?.key||"";v&&(k(v),D(!0))},z=()=>{D(!1)},K=o=>{A(o)};return e.jsxs(J,{children:[e.jsx(W,{title:"Relatórios"}),e.jsxs("div",{className:"w-full max-w-[1450px] 2xl:max-w-[1500px] mx-auto px-3 py-3 space-y-4 sm:px-4 sm:py-4 lg:px-6 lg:py-5",children:[e.jsxs("header",{className:"space-y-1.5 pt-0.5 sm:pt-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-semibold text-gray-900 dark:text-gray-100",children:"Relatórios"}),e.jsx("p",{className:"text-xs sm:text-sm lg:text-base text-gray-600 dark:text-gray-300 max-w-3xl",children:"Acompanhe todas as suas transações em faturas, veja um resumo financeiro por período, filtre por conta e categoria e exporte um arquivo Excel completo."})]}),e.jsx("section",{className:"rounded-2xl bg-white p-3 shadow-md ring-1 ring-black/5 dark:bg-[#0b0b0b] dark:ring-black/30 sm:p-3 lg:p-4 space-y-3",children:e.jsxs("div",{className:"flex flex-col gap-2 text-xs sm:text-sm sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[e.jsx("div",{className:"flex w-full flex-col gap-1 sm:w-auto sm:flex-row sm:items-center sm:gap-2",children:e.jsxs("select",{value:t,onChange:o=>m(o.target.value),className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-xs sm:text-sm shadow-sm focus:border-rose-500 focus:ring-rose-500 dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100 sm:min-w-[200px]",children:[e.jsx("option",{value:"",children:"Todos"}),a.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]})}),e.jsx("div",{className:"flex w-full flex-col gap-1 sm:w-auto sm:flex-row sm:items-center sm:gap-2",children:e.jsxs("select",{value:n,onChange:o=>p(o.target.value),className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-xs sm:text-sm shadow-sm focus:border-rose-500 focus:ring-rose-500 dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100 sm:min-w-[200px]",children:[e.jsx("option",{value:"",children:"Todas"}),l.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]})})]}),e.jsx("div",{className:"flex justify-end w-full sm:w-auto",children:e.jsx(te,{filters:{bank_user_id:t||void 0,category_id:n||void 0}})})]})}),e.jsxs("section",{className:"grid grid-cols-1 gap-3 lg:grid-cols-2",children:[e.jsx(se,{periods:d,selectedKey:b,onChange:k,onOpen:I,isLoading:B}),e.jsx(le,{insights:$})]}),e.jsxs("section",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx(w,{title:"Receitas pagas",value:x(r.total_income)}),e.jsx(w,{title:"Despesas pagas",value:x(r.total_expenses)}),e.jsx(w,{title:"Receitas pendentes",value:x(r.pending_income)}),e.jsx(w,{title:"Despesas pendentes",value:x(r.pending_expenses)}),e.jsx(w,{title:"Transações no débito (mês atual)",value:x(r.current_month_debit_total)}),e.jsx(w,{title:"Faturas vencidas",value:r.overdue_count})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Resumo por mês / ano"}),B&&e.jsx("span",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:"Carregando dados..."})]}),e.jsx(ae,{items:g,onSelectPeriod:I})]}),e.jsx(re,{isOpen:F,onClose:z,period:O,onSelectTransaction:K}),e.jsx(ee,{isOpen:!!P,onClose:()=>A(null),item:P})]})]})}export{je as default};
