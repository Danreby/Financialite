import{r as d,j as e,a as N,y as f,H as E}from"./app-8gfwU8XK.js";import{A as T}from"./AuthenticatedLayout-DZhWVRWB.js";import{E as B}from"./ExportExcel-BoVPvQ_S.js";import{S as x,f as g}from"./formatters-M4SE7nbc.js";/* empty css            */import"./proxy-DwQSvc6a.js";import"./BareButton-CCbEy2nf.js";import"./Tooltip-C7erSd6-.js";function D({filters:s={}}){const[r,m]=d.useState([]);d.useEffect(()=>{let i=!0;return(async()=>{try{const a=await N.get(route("faturas.export_data"),{params:{bank_user_id:s.bank_user_id||void 0,category_id:s.category_id||void 0}});if(!i)return;const j=[...Array.isArray(a.data)?a.data:[]].sort((h,y)=>{const p=h.year_month||"",t=y.year_month||"";return p===t?String(h.created_at||"").localeCompare(String(y.created_at||"")):p.localeCompare(t)});m(j)}catch(a){console.error(a),a.response?.data?.message?f.error(a.response.data.message):f.error("Não foi possível carregar as transações para exportação.")}})(),()=>{i=!1}},[s.bank_user_id,s.category_id]);const b=d.useMemo(()=>({month_label:{name:"Mês/Ano"},created_at_formatted:{name:"Data"},type:{name:"Tipo"},status:{name:"Status"},title:{name:"Título"},description:{name:"Descrição"},amount:{name:"Valor"},total_installments:{name:"Parcelas Totais"},current_installment:{name:"Parcela Atual"},is_recurring:{name:"Recorrente"},"bank_user.bank.name":{name:"Banco"},"category.name":{name:"Categoria"}}),[]);return e.jsx(B,{data:r,header:b,name:"transacoes_faturas",currencyColumns:["Valor"]})}function v(s){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).format(s||0)}function I({items:s=[]}){return!s||s.length===0?e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:"Nenhuma transação encontrada para os filtros atuais."}):e.jsxs("div",{className:"mt-2 rounded-2xl bg-white p-3 sm:p-3 lg:p-4 shadow-sm ring-1 ring-black/5 dark:bg-[#080808] dark:ring-white/5",children:[e.jsx("h2",{className:"text-sm sm:text-base font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Resumo por mês / ano"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"max-h-[320px] md:max-h-[360px] lg:max-h-[400px] 2xl:max-h-[400px] overflow-y-auto",children:e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-800 text-[11px] sm:text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400",children:[e.jsx("th",{className:"py-2 pr-3 text-left",children:"Mês / Ano"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"Total geral"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"Total crédito"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"Total débito"}),e.jsx("th",{className:"py-2 pl-3 text-right",children:"Qtd. transações"})]})}),e.jsx("tbody",{children:s.map(r=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800 last:border-0 hover:bg-gray-50 dark:hover:bg-gray-900/40",children:[e.jsx("td",{className:"py-1.5 pr-3 text-left text-gray-800 dark:text-gray-100 whitespace-nowrap",children:r.month_label||r.year_month||"Sem data"}),e.jsx("td",{className:"py-1.5 px-3 text-right text-gray-900 dark:text-gray-100 whitespace-nowrap",children:v(r.total_amount)}),e.jsx("td",{className:"py-1.5 px-3 text-right text-emerald-600 dark:text-emerald-400 whitespace-nowrap",children:v(r.total_credit)}),e.jsx("td",{className:"py-1.5 px-3 text-right text-rose-600 dark:text-rose-400 whitespace-nowrap",children:v(r.total_debit)}),e.jsx("td",{className:"py-1.5 pl-3 text-right text-gray-700 dark:text-gray-200 whitespace-nowrap",children:r.count})]},r.year_month||r.month_label))})]})})})]})}function G({bankAccounts:s=[],categories:r=[]}){const[m,b]=d.useState(""),[i,k]=d.useState(""),[a,w]=d.useState({total_income:0,total_expenses:0,pending_income:0,pending_expenses:0,current_month_debit_total:0,overdue_count:0}),[j,h]=d.useState([]),[y,p]=d.useState(!1);return d.useEffect(()=>{let t=!0;return(async()=>{p(!0);try{const[u,S]=await Promise.all([N.get(route("faturas.stats"),{params:{bank_user_id:m||void 0,category_id:i||void 0}}),N.get(route("faturas.export_data"),{params:{bank_user_id:m||void 0,category_id:i||void 0}})]);if(!t)return;const c=u.data||{};w({total_income:Number(c.total_income||0),total_expenses:Number(c.total_expenses||0),pending_income:Number(c.pending_income||0),pending_expenses:Number(c.pending_expenses||0),current_month_debit_total:Number(c.current_month_debit_total||0),overdue_count:Number(c.overdue_count||0)});const C=(Array.isArray(S.data)?S.data:[]).reduce((l,o)=>{const n=o.invoice_month||o.year_month||"sem-data";l[n]||(l[n]={year_month:n,month_label:o.invoice_month_label||o.month_label||n||"Sem data",total_amount:0,total_credit:0,total_debit:0,count:0});const _=Number(o.type==="debit"&&o.amount||0),R=Number(o.type==="credit"&&o.installment_amount||0);return l[n].total_debit+=_,l[n].total_credit+=R,l[n].total_amount+=_+R,l[n].count+=1,l},{}),A=Object.values(C).sort((l,o)=>{const n=l.year_month||"",_=o.year_month||"";return n.localeCompare(_)});h(A)}catch(u){console.error(u),u.response?.data?.message?f.error(u.response.data.message):f.error("Não foi possível carregar os dados do relatório.")}finally{t&&p(!1)}})(),()=>{t=!1}},[m,i]),e.jsxs(T,{children:[e.jsx(E,{title:"Relatórios"}),e.jsxs("div",{className:"w-full max-w-[1450px] 2xl:max-w-[1500px] mx-auto px-3 py-3 space-y-4 sm:px-4 sm:py-4 lg:px-6 lg:py-5",children:[e.jsxs("header",{className:"space-y-1.5 pt-0.5 sm:pt-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-semibold text-gray-900 dark:text-gray-100",children:"Relatórios"}),e.jsx("p",{className:"text-xs sm:text-sm lg:text-base text-gray-600 dark:text-gray-300 max-w-3xl",children:"Acompanhe todas as suas transações em faturas, veja um resumo financeiro por período, filtre por conta e categoria e exporte um arquivo Excel completo."})]}),e.jsx("section",{className:"rounded-2xl bg-white p-3 shadow-md ring-1 ring-black/5 dark:bg-[#0b0b0b] dark:ring-black/30 sm:p-3 lg:p-4 space-y-3",children:e.jsxs("div",{className:"flex flex-col gap-2 text-xs sm:text-sm sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[e.jsx("div",{className:"flex w-full flex-col gap-1 sm:w-auto sm:flex-row sm:items-center sm:gap-2",children:e.jsxs("select",{value:m,onChange:t=>b(t.target.value),className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-xs sm:text-sm shadow-sm focus:border-rose-500 focus:ring-rose-500 dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100 sm:min-w-[200px]",children:[e.jsx("option",{value:"",children:"Todos"}),s.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})}),e.jsx("div",{className:"flex w-full flex-col gap-1 sm:w-auto sm:flex-row sm:items-center sm:gap-2",children:e.jsxs("select",{value:i,onChange:t=>k(t.target.value),className:"w-full rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-xs sm:text-sm shadow-sm focus:border-rose-500 focus:ring-rose-500 dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100 sm:min-w-[200px]",children:[e.jsx("option",{value:"",children:"Todas"}),r.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})})]}),e.jsx("div",{className:"flex justify-end w-full sm:w-auto",children:e.jsx(D,{filters:{bank_user_id:m||void 0,category_id:i||void 0}})})]})}),e.jsxs("section",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx(x,{title:"Receitas pagas",value:g(a.total_income)}),e.jsx(x,{title:"Despesas pagas",value:g(a.total_expenses)}),e.jsx(x,{title:"Receitas pendentes",value:g(a.pending_income)}),e.jsx(x,{title:"Despesas pendentes",value:g(a.pending_expenses)}),e.jsx(x,{title:"Transações no débito (mês atual)",value:g(a.current_month_debit_total)}),e.jsx(x,{title:"Faturas vencidas",value:a.overdue_count})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Resumo por mês / ano"}),y&&e.jsx("span",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:"Carregando dados..."})]}),e.jsx(I,{items:j})]})]})]})}export{G as default};
