import{j as e,r as k,y as C,a as A,H as V,c as F}from"./app-BRy3IDCE.js";import{A as O}from"./AuthenticatedLayout-CorKAXFK.js";import{M as $,S as M}from"./SecondaryButton-OZ-h4nCj.js";import{P as L}from"./PrimaryButton-CMvMSctb.js";import{S as E}from"./ScrollArea-CES-MrG7.js";import{F as z}from"./FaturaDetailModal-BfGGIvSf.js";import{B,A as H}from"./BareButton-D2GXtjzu.js";import{T as q}from"./Tooltip-Cjjeu0b2.js";import{m as W}from"./proxy-DE30lHB3.js";import{E as U}from"./ExportExcel-CQdgpfuV.js";/* empty css            */function K(r){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).format(r||0)}function J(r){if(!r)return"";const l=new Date(r);if(Number.isNaN(l.getTime()))return"";const g=l.getDate().toString().padStart(2,"0"),d=l.toLocaleDateString("pt-BR",{month:"short"});return`${g} ${d}`}function Q({title:r,description:l,amount:g,type:d,status:i,created_at:a,bank_name:m,total_installments:s,current_installment:c,display_installment:n,is_recurring:p,category_name:o,onClick:t}){const x=d==="credit",v=d==="debit",y="-",_="text-rose-500 dark:text-rose-400",S=Math.max(Number(s||1),1),N=Number(g||0)||0,f=S>1?N/S:N,h=J(a),w=i==="paid"?"Pago":i==="overdue"?"Vencido":"Em aberto",u=i==="paid"?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-300":i==="overdue"?"bg-rose-100 text-rose-700 dark:bg-rose-900/40 dark:text-rose-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300",j=s&&s>1?n||c||1:null,b=s&&s>1&&j?`${j}/${s}`:null;return e.jsxs("div",{className:"flex items-center justify-between gap-3 px-2 sm:px-3 lg:px-3 2xl:px-3 py-1.5 lg:py-2 2xl:py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-900/60 transition cursor-pointer",onClick:t,role:t?"button":void 0,tabIndex:t?0:void 0,children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0",children:[e.jsx("div",{className:"h-8 w-8 lg:h-9 lg:w-9 2xl:h-9 2xl:w-9 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center",children:e.jsx("span",{className:`h-2 w-2 rounded-full ${v||x?"bg-rose-500":"bg-gray-400"}`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"truncate text-sm lg:text-base 2xl:text-base font-medium text-gray-900 dark:text-gray-100",children:r}),b&&e.jsx("span",{className:"rounded-full bg-purple-100 px-2.5 py-0.5 text-[11px] sm:text-xs 2xl:text-sm font-semibold uppercase tracking-wide text-purple-700 dark:bg-purple-900/40 dark:text-purple-300",children:b}),p&&e.jsx("span",{className:"rounded-full bg-blue-100 px-2.5 py-0.5 text-[10px] sm:text-[11px] 2xl:text-[11px] font-semibold uppercase tracking-wide text-blue-700 dark:bg-blue-900/40 dark:text-blue-300",children:"Recorrente"})]}),e.jsxs("div",{className:"mt-0.5 flex flex-wrap items-center gap-2 text-[11px] lg:text-xs 2xl:text-xs text-gray-500 dark:text-gray-400",children:[m&&e.jsx("span",{children:m}),o&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-[10px] sm:text-[11px] 2xl:text-[11px] font-medium text-gray-600 dark:bg-gray-800 dark:text-gray-200",children:o}),l&&e.jsxs("span",{className:"truncate max-w-xs",children:["• ",l]})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsxs("span",{className:`text-sm lg:text-base 2xl:text-base font-semibold ${_}`,children:[y,K(f)]}),e.jsxs("div",{className:"flex items-center gap-2 text-[11px] lg:text-xs 2xl:text-xs text-gray-500 dark:text-gray-400",children:[h&&e.jsx("span",{children:h}),e.jsx("span",{className:`rounded-full px-2.5 py-0.5 text-[10px] sm:text-[11px] 2xl:text-[11px] ${u}`,children:w})]})]})]})}function P(r){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).format(r||0)}function X({isOpen:r,onClose:l,monthKey:g,monthLabel:d,items:i=[],bankUserId:a=null,onPaid:m}){const[s,c]=k.useState(!1),n=k.useMemo(()=>i.filter(t=>t.status!=="paid"),[i]),p=k.useMemo(()=>n.reduce((t,x)=>{const v=x.total_installments||1,y=(x.amount||0)/v;return t+y},0),[n]),o=async()=>{if(!s){c(!0),C.dismiss();try{const t={month:g};a&&(t.bank_user_id=a),await A.post(route("faturas.pay_month"),t),C.success("Pagamentos do mês registrados com sucesso."),c(!1),m&&m(),l&&l()}catch(t){console.error(t),c(!1),t.response&&t.response.data?.message?C.error(t.response.data.message):C.error("Erro ao registrar pagamentos do mês.")}}};return e.jsxs($,{isOpen:r,onClose:l,maxWidth:"md",title:`Pagar fatura de ${d}`,children:[e.jsx("div",{className:"space-y-4 text-sm sm:text-base",children:n.length===0?e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Não há pendências para este mês."}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Você está prestes a registrar o pagamento das pendências deste mês."}),e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-3 sm:p-4 text-xs sm:text-sm shadow-sm dark:border-gray-800 dark:bg-[#050505]",children:[e.jsx("p",{className:"mb-2 text-[11px] sm:text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-400",children:"Pendências do mês"}),e.jsx(E,{maxHeightClassName:"max-h-64",className:"space-y-2 pr-1",children:n.map(t=>{const x=t.total_installments||1,v=t.current_installment||0,y=(t.amount||0)/x,_=x>1?t.display_installment||Math.min(v+1,x):1,S=Math.max(x-(_-1),0);return e.jsxs("div",{className:"flex items-center justify-between gap-3 rounded-lg bg-gray-50 px-2.5 py-2 text-gray-700 dark:bg-gray-900 dark:text-gray-200",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-sm font-medium",children:t.title}),e.jsxs("p",{className:"mt-0.5 text-[11px] sm:text-xs text-gray-500 dark:text-gray-400",children:["Parcela atual: ",_,"/",x," • Valor da parcela: ",P(y)]})]}),e.jsx("div",{className:"text-right text-[11px] sm:text-xs text-gray-500 dark:text-gray-400",children:e.jsxs("p",{children:["Restantes: ",S]})})]},t.id)})}),e.jsxs("div",{className:"mt-3 flex items-center justify-between border-t border-dashed border-gray-200 pt-2 text-[11px] sm:text-xs dark:border-gray-700",children:[e.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-300",children:"Total a pagar agora"}),e.jsx("span",{className:"font-semibold text-rose-600 dark:text-rose-400",children:P(p)})]})]}),e.jsx("p",{className:"text-[11px] sm:text-xs text-gray-500 dark:text-gray-400",children:'Observação: faturas parceladas só serão marcadas como "pagas" quando todas as parcelas forem quitadas.'})]})}),e.jsxs("div",{className:"mt-5 flex items-center justify-end gap-3",children:[e.jsx(M,{type:"button",onClick:l,className:"rounded-lg px-4 py-2 text-xs sm:text-sm font-medium text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800",children:"Cancelar"}),e.jsx(L,{type:"button",disabled:s||n.length===0,onClick:o,children:s?"Registrando...":"Confirmar pagamento"})]})]})}function Y(r){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).format(r||0)}function Z({month_label:r,total_spent:l,items:g=[],month_key:d,bankUserId:i=null,onPaid:a,is_paid:m=!1,due_day:s=null,isCurrentPending:c=!1}){const[n,p]=k.useState(!1),[o,t]=k.useState("date"),[x,v]=k.useState("desc"),[y,_]=k.useState(null),S=k.useMemo(()=>{const N=[...g];return N.sort((f,h)=>{if(o==="date"){const w=f.created_at?new Date(f.created_at):null,u=h.created_at?new Date(h.created_at):null,j=w&&!Number.isNaN(w.getTime())?w.getTime():0,b=u&&!Number.isNaN(u.getTime())?u.getTime():0;return x==="asc"?j-b:b-j}if(o==="amount"){const w=Number(f.amount)||0,u=Number(h.amount)||0;return x==="asc"?w-u:u-w}return 0}),N},[g,o,x]);return e.jsxs("section",{className:"space-y-3 sm:space-y-4 lg:space-y-5 2xl:space-y-5",children:[e.jsxs("div",{className:"flex flex-col items-start gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{className:"flex-1 flex justify-start items-center gap-3 sm:gap-4",children:e.jsxs("div",{className:"inline-flex flex-col items-start rounded-2xl sm:rounded-full px-4 py-2 sm:px-6 sm:py-3 bg-transparent",children:[s&&e.jsxs("p",{className:"mt-0.5 text-[11px] sm:text-xs lg:text-sm 2xl:text-sm text-gray-500 dark:text-gray-400",children:["Vencimento do cartão: todo dia ",e.jsx("span",{className:"font-semibold",children:s})]}),e.jsxs("p",{className:"mt-1 text-[11px] sm:text-xs lg:text-sm 2xl:text-sm text-gray-500 dark:text-gray-400",children:["Total de despesas do mês",":",e.jsx("span",{className:"ml-1 font-semibold text-rose-600 dark:text-rose-400",children:Y(l)})]})]})}),c&&e.jsx(L,{type:"button",onClick:()=>p(!0),className:"shrink-0 rounded-full px-4 py-2 text-[11px] sm:text-xs font-semibold uppercase tracking-wide focus:ring-rose-500 focus:ring-offset-2 dark:ring-offset-[#050505] w-full sm:w-auto",children:"Pagar"})]}),e.jsx("div",{className:"rounded-2xl bg-white border border-gray-50/90 dark:border-red-950/50 px-2 py-2 sm:px-3 sm:py-3 lg:px-4 lg:py-3 2xl:px-4 2xl:py-3 shadow-sm ring-1 ring-black/5 dark:bg-[#080808] dark:ring-white/5 shadow-gray-500 dark:shadow-gray-900",children:g.length===0?e.jsx("p",{className:"px-3 py-2 text-xs sm:text-sm lg:text-base 2xl:text-sm text-gray-500 dark:text-gray-400",children:"Nenhuma transação neste mês."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-3 pt-1 pb-1 text-[11px] sm:text-xs lg:text-sm 2xl:text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-semibold uppercase tracking-wide",children:"Ordenar"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{type:"button",onClick:()=>t("date"),className:`inline-flex items-center rounded-full border px-3 py-1.5 text-[10px] sm:text-[11px] 2xl:text-[11px] font-medium transition ${o==="date"?"border-[#7b1818] bg-[#7b1818] text-white shadow-sm dark:border-rose-500 dark:bg-rose-500":"border-gray-300 bg-white text-gray-600 hover:bg-gray-50 dark:border-gray-700 dark:bg-[#050505] dark:text-gray-200 dark:hover:bg-gray-800"}`,children:"Data"}),e.jsx(B,{type:"button",onClick:()=>t("amount"),className:`inline-flex items-center rounded-full border px-3 py-1.5 text-[10px] sm:text-[11px] 2xl:text-[11px] font-medium transition ${o==="amount"?"border-[#7b1818] bg-[#7b1818] text-white shadow-sm dark:border-rose-500 dark:bg-rose-500":"border-gray-300 bg-white text-gray-600 hover:bg-gray-50 dark:border-gray-700 dark:bg-[#050505] dark:text-gray-200 dark:hover:bg-gray-800"}`,children:"Valor"}),e.jsx(q,{label:x==="desc"?"Do mais recente/mais caro para o mais antigo/mais barato":"Do mais antigo/mais barato para o mais recente/mais caro",children:e.jsx(B,{type:"button",onClick:()=>v(N=>N==="desc"?"asc":"desc"),className:"inline-flex items-center rounded-full border border-gray-300 bg-white px-2.5 py-1.5 text-[10px] sm:text-[11px] 2xl:text-[11px] font-medium text-gray-600 shadow-sm hover:bg-gray-50 dark:border-gray-700 dark:bg-[#050505] dark:text-gray-200 dark:hover:bg-gray-800",children:x==="desc"?"▼":"▲"})})]})]}),e.jsx(E,{maxHeightClassName:"max-h-[360px] md:max-h-[420px] lg:max-h-[460px] 2xl:max-h-[400px]",className:"divide-y divide-gray-100 dark:divide-gray-800",children:S.map(N=>e.jsx(Q,{...N,onClick:()=>_(N)},N.id))})]})}),e.jsx(X,{isOpen:n,onClose:()=>p(!1),monthKey:d,monthLabel:r,items:g,bankUserId:i,onPaid:a}),e.jsx(z,{isOpen:!!y,onClose:()=>_(null),item:y})]})}function G({months:r=[],total_spent:l,selectedMonthKey:g,onChangeMonth:d}){if(!r||r.length===0)return null;const i=(f,h)=>{if(!f||typeof f!="string")return h||f||"";const[w,u]=f.split("-"),j=parseInt(w,10),b=parseInt(u,10);if(!j||!b)return h||f;try{const D=new Date(j,b-1,1);return new Intl.DateTimeFormat("pt-BR",{month:"long",year:"numeric"}).format(D)}catch{return h||f}},a=r.findIndex(f=>f.month_key===g),m=a===-1?0:a,s=r[m],c=r[m-1]||null,n=r[m+1]||null,p=s?.is_paid,o=!!c,t=!!n,[x,v]=k.useState(0),y=()=>{o&&(v(-1),d(c.month_key))},_=()=>{t&&(v(1),d(n.month_key))},S={enter:f=>({x:f>0?100:-100,opacity:0,scale:.96}),center:{x:0,opacity:1,scale:1,transition:{type:"spring",stiffness:260,damping:25}},exit:f=>({x:f<0?100:-100,opacity:0,scale:.96,transition:{duration:.18}})};function N(f){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).format(f||0)}return e.jsxs("div",{className:"flex flex-col items-stretch gap-2 sm:flex-row sm:items-center sm:justify-center sm:gap-3 lg:gap-4 2xl:gap-4",children:[e.jsx("div",{className:"flex justify-between sm:w-32 sm:justify-end",children:c&&e.jsx(M,{type:"button",onClick:y,className:"rounded-full px-3 py-1 text-[11px] font-medium text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-900 border-none shadow-none",children:i(c.month_key,c.month_label)})}),e.jsx("div",{className:"flex-1 flex justify-center",children:e.jsx(H,{custom:x,initial:!1,mode:"wait",children:e.jsxs(W.div,{custom:x,variants:S,initial:"enter",animate:"center",exit:"exit",className:`inline-flex flex-col items-center rounded-full px-4 py-2 sm:px-6 sm:py-2 lg:px-8 lg:py-3 2xl:px-8 2xl:py-3 shadow-sm ring-1 bg-gradient-to-r dark:bg-gradient-to-r ${p?"from-emerald-50 via-white to-emerald-50 ring-emerald-200 dark:from-[#052e26] dark:via-[#050505] dark:to-[#052e26] dark:ring-emerald-900/50":"from-rose-50 via-white to-rose-50 ring-rose-100 dark:from-[#150709] dark:via-[#0b0b0b] dark:to-[#150709] dark:ring-rose-900/40"}`,children:[p?e.jsx("span",{className:"text-sm font-medium text-emerald-600 dark:text-emerald-400",children:"Paga"}):e.jsx("div",{}),e.jsx("span",{className:`mt-1 text-lg sm:text-xl md:text-2xl lg:text-3xl 2xl:text-3xl font-bold tracking-tight ${p?"text-emerald-600 dark:text-emerald-400":"text-gray-900 dark:text-gray-50"}`,children:i(s.month_key,s.month_label)}),e.jsx("span",{className:`font-semibold text-xl sm:text-2xl lg:text-3xl 2xl:text-3xl ${p?"text-emerald-600 dark:text-emerald-400":"text-rose-600 dark:text-rose-400"}`,children:N(l)})]},s.month_key)})}),e.jsx("div",{className:"flex justify-between sm:w-32 sm:justify-start",children:n&&e.jsx(M,{type:"button",onClick:_,className:"rounded-full px-3 py-1 text-[11px] sm:text-xs 2xl:text-sm font-medium text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-900 border-none shadow-none",children:i(n.month_key,n.month_label)})})]})}function ee({monthlyGroups:r=[]}){const{rows:l,header:g}=k.useMemo(()=>{if(!r||r.length===0)return{rows:[],header:{}};const d=[],i={};r.forEach(o=>{!o||!o.month_key||o.is_paid||(d.push(o.month_key),o.month_label&&(i[o.month_key]=o.month_label))});const a=Array.from(new Set(d)).sort(),m=new Map;r.forEach(o=>{const t=o.month_key;!t||o.is_paid||!o.items||o.items.forEach(x=>{if(!x||x.status==="paid")return;const v=x.category_name||x.title||"Sem categoria",y=v,_=Math.max(Number(x.total_installments||1),1),N=(Number(x.amount||0)||0)/_;if(!m.has(y)){const h={label:v};a.forEach(w=>{h[w]=0}),h.total=0,m.set(y,h)}const f=m.get(y);f[t]=Number(f[t]||0)+N,f.total=Number(f.total||0)+N})});const s=Array.from(m.values());if(s.length===0)return{rows:[],header:{}};const c={label:"TOTAL GERAL"};let n=0;a.forEach(o=>{let t=0;s.forEach(x=>{t+=Number(x[o]||0)}),n+=t,c[o]=t}),c.total=n,s.push(c);const p={label:{name:"Categoria / Compra"}};return a.forEach(o=>{p[o]={name:i[o]||o}}),p.total={name:"TOTAL"},{rows:s,header:p}},[r]);return!l||l.length===0?null:e.jsx(U,{data:l,header:g,name:"faturas_pendentes"})}function T(...r){return r.filter(Boolean).join(" ")}function te({months:r=[],value:l,onChange:g}){const[d,i]=k.useState(!1),a=k.useRef(null),m=k.useRef(null),s=r.find(n=>n.month_key===l)||r[0]||null;if(k.useEffect(()=>{if(!d)return;const n=p=>{m.current&&!m.current.contains(p.target)&&a.current&&!a.current.contains(p.target)&&i(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[d]),!r||r.length===0)return null;const c=n=>{g&&g(n),i(!1)};return e.jsxs("div",{className:"relative inline-block text-left",children:[e.jsxs("button",{type:"button",ref:a,onClick:()=>i(n=>!n),className:"inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-2.5 py-1.5 text-[11px] lg:text-xs 2xl:text-xs shadow-sm focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-rose-500 dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100",children:[e.jsx("span",{className:"inline-flex flex-col text-left",children:e.jsxs("span",{className:"text-[11px] lg:text-xs 2xl:text-xs font-medium text-gray-900 dark:text-gray-100",children:[s?s.month_label:"Selecione um mês",s&&s.is_paid?" (paga)":""]})}),e.jsx("svg",{className:T("h-4 w-4 text-gray-500 dark:text-gray-400 transition-transform",d?"rotate-180":"rotate-0"),viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M5.25 7.5L10 12.25L14.75 7.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]}),d&&e.jsx("div",{ref:m,className:"absolute right-0 z-20 mt-2 w-64 sm:w-80 2xl:w-80 origin-top-right rounded-2xl bg-white p-3 shadow-xl ring-1 ring-black/5 dark:bg-[#050505] dark:ring-black/40",children:e.jsx(E,{maxHeightClassName:"max-h-56 2xl:max-h-56",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 mr-2",children:r.map(n=>{const p=n.month_key===(s&&s.month_key);return n.is_paid,e.jsx("button",{type:"button",onClick:()=>c(n.month_key),className:T("flex flex-col items-start rounded-xl border px-2.5 py-2 text-left transition-colors","hover:border-rose-400 hover:bg-rose-50/60 dark:hover:border-rose-500/70 dark:hover:bg-rose-900/20",p?"border-rose-500 bg-rose-50 dark:border-rose-500/80 dark:bg-rose-900/30":"border-gray-200 bg-gray-50/60 dark:border-gray-800 dark:bg-[#050505]"),children:e.jsx("span",{className:"text-sm 2xl:text-sm font-medium text-gray-800 dark:text-gray-100 leading-tight",children:n.month_label})},n.month_key)})})})})]})}function re({bankAccounts:r=[],categories:l=[],filters:g={},months:d=[],monthValue:i,onFiltersChange:a,onMonthChange:m}){const s=g?.bank_user_id??"",c=g?.category_id??"",n=t=>{const x=t.target.value||void 0;a&&a({bank_user_id:x,category_id:c||void 0})},p=t=>{const x=t.target.value||void 0;a&&a({bank_user_id:s||void 0,category_id:x})},o=t=>{!t||!m||m(t)};return e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs sm:text-sm lg:text-sm 2xl:text-sm",children:[e.jsxs("select",{value:s||"",onChange:n,className:"min-w-[190px] sm:min-w-[210px] lg:min-w-[230px] 2xl:min-w-[230px] rounded-lg border border-gray-300 bg-white px-2.5 py-1.5 text-xs sm:text-sm 2xl:text-sm shadow-sm focus:border-rose-500 focus:ring-rose-500 dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Todos os bancos"}),r.map(t=>e.jsxs("option",{value:t.id,children:[t.name,t.due_day?` - vence todo dia ${t.due_day}`:""]},t.id))]}),e.jsxs("select",{value:c||"",onChange:p,className:"min-w-[190px] sm:min-w-[210px] lg:min-w-[230px] 2xl:min-w-[230px] rounded-lg border border-gray-300 bg-white px-2.5 py-1.5 text-xs sm:text-sm 2xl:text-sm shadow-sm focus:border-rose-500 focus:ring-rose-500 dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Todas as categorias"}),l.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),d&&d.length>0&&e.jsx(te,{months:d,value:i,onChange:o})]})}function I(r){if(!r||typeof r!="string")return 0;const[l,g]=r.split("-"),d=parseInt(l,10)||0,i=parseInt(g,10)||0;return d*12+(i-1)}function R(r,l){if(!r||r.length===0)return null;if(l){if(r.some(m=>m.month_key===l))return l;const d=I(l);let i=r[0],a=Math.abs(I(i.month_key)-d);for(const m of r){const s=Math.abs(I(m.month_key)-d);s<a&&(i=m,a=s)}return i.month_key}return r[0].month_key}function ae(r="",l,g){const[d,i]=k.useState(r);return{value:d,setValue:i,handleChange:s=>{let c=s.target.value??"";c=c.replace(/[^0-9]/g,"");{const n=String(g).length;c.length>n&&(c=c.slice(0,n))}i(c)},isValid:(()=>{if(d==="")return!1;const s=parseInt(d,10);return!(Number.isNaN(s)||s<l||s>g)})(),numericValue:d===""?null:parseInt(d,10)}}function pe({monthlyGroups:r=[],bankAccounts:l=[],categories:g=[],filters:d={},currentMonthKey:i=null}){const a=k.useMemo(()=>{if(!Array.isArray(r))return[];const u=new Map;for(const b of r)!b||!b.month_key||typeof b.month_key!="string"||u.has(b.month_key)||u.set(b.month_key,b);const j=Array.from(u.values());return j.sort((b,D)=>I(b.month_key)-I(D.month_key)),j},[r]),m=d?.bank_user_id??"",[s,c]=k.useState(()=>R(a,i)),[n,p]=k.useState(!1),o=ae("",1,31),[t,x]=k.useState(!1);k.useEffect(()=>{if(!a||a.length===0){c(null);return}if(!a.some(j=>j.month_key===s)){const j=R(a,i);c(j)}},[a,s,i]);const v=u=>{F.get(route("faturas.index"),u,{preserveState:!0,preserveScroll:!0})},y=l&&l.length>0&&m?l.find(u=>String(u.id)===String(m)):null,_=u=>{c(u)},S=()=>{y&&(o.setValue(y.due_day?String(y.due_day):""),p(!0))},N=async u=>{if(u.preventDefault(),!y||t)return;if(!o.isValid){C.error("Informe um dia de vencimento entre 1 e 31.");return}const j=o.numericValue;x(!0),C.dismiss();try{await A.patch(route("banks.update-due-day",y.id),{due_day:j}),C.success("Dia de vencimento atualizado com sucesso."),p(!1),F.reload({only:["bankAccounts"]})}catch(b){console.error(b),C.error("Não foi possível atualizar o dia de vencimento.")}finally{x(!1)}},f=()=>{if(!a||a.length===0||!h){F.reload({only:["monthlyGroups"],preserveState:!0});return}const u=a.findIndex(D=>D.month_key===h.month_key),j=u>0?u-1:u,b=a[j]||h;c(b.month_key),F.reload({only:["monthlyGroups"],preserveState:!0})},h=a&&a.length>0?a.find(u=>u.month_key===s)||a[0]:null,w=R(a,i);return e.jsxs(O,{children:[e.jsx(V,{title:"Faturas"}),e.jsxs("div",{className:"w-full max-w-[1500px] 2xl:max-w-[1600px] mx-auto px-3 sm:px-4 lg:px-6 2xl:px-6 space-y-4 sm:space-y-5 lg:space-y-6 2xl:space-y-6",children:[e.jsxs("header",{className:"pt-1 sm:pt-2 space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl 2xl:text-3xl font-semibold text-gray-900 mb-1 dark:text-gray-100",children:"Faturas"}),e.jsx("p",{className:"text-xs sm:text-sm lg:text-base 2xl:text-base text-gray-600 dark:text-gray-300",children:"Visualize suas despesas agrupadas por mês."})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsx(re,{bankAccounts:l,categories:g,filters:d,months:a,monthValue:h?.month_key||s,onFiltersChange:v,onMonthChange:_}),e.jsx("div",{className:"flex justify-start md:justify-end",children:e.jsx(ee,{monthlyGroups:r})})]}),y&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs sm:text-sm 2xl:text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("span",{children:["Dia de vencimento:"," ",y.due_day?`todo dia ${y.due_day}`:"ainda não definido"]}),e.jsx(M,{type:"button",onClick:S,className:"rounded-full px-4 py-1.5 text-[11px] sm:text-xs font-semibold uppercase tracking-wide text-rose-600 border border-rose-500 hover:bg-rose-50 dark:border-rose-500/70 dark:text-rose-300 dark:hover:bg-rose-900/20",children:"Definir dia de vencimento"})]})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4 lg:space-y-5 2xl:space-y-5 pb-4 sm:pb-6 2xl:pb-6",children:[(!a||a.length===0)&&e.jsx("p",{className:"text-xs sm:text-sm lg:text-base 2xl:text-base text-gray-500 dark:text-gray-400",children:"Nenhuma fatura encontrada para o filtro atual."}),a&&a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(G,{months:a,selectedMonthKey:h?.month_key,onChangeMonth:_,...h}),h&&e.jsx(Z,{...h,month_key:h.month_key,bankUserId:m||null,due_day:y?.due_day??null,onPaid:f,isCurrentPending:w&&h.month_key===w&&!h.is_paid},h.month_key)]})]}),e.jsx($,{isOpen:n,onClose:()=>!t&&p(!1),maxWidth:"sm",title:"Definir dia de vencimento",children:e.jsxs("form",{className:"space-y-4",onSubmit:N,noValidate:!0,children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 dark:text-gray-200",children:"Dia de vencimento do cartão (1 a 31)"}),e.jsx("input",{type:"number",min:1,max:31,inputMode:"numeric",value:o.value,onChange:o.handleChange,className:"w-full rounded-md border border-gray-300 bg-white p-2 text-xs sm:text-sm shadow-sm dark:border-gray-700 dark:bg-[#0f0f0f] dark:text-gray-100"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-2 text-xs sm:text-xs",children:[e.jsx(M,{type:"button",onClick:()=>!t&&p(!1),className:"rounded-lg px-4 py-2 font-medium text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800",children:"Cancelar"}),e.jsx(L,{type:"submit",disabled:t,className:"rounded-lg px-4 py-2 font-semibold uppercase tracking-wide disabled:cursor-not-allowed",children:t?"Salvando...":"Salvar dia"})]})]})})]})]})}export{pe as default};
